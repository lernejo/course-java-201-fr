<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<meta name="author" content="LoÃ¯c Ledoyen">
<title>Java 201 - Architecture logicielle</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sa {
  color: #000000;
  font-weight: bold;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Java 201 - Architecture logicielle</h1>
<div class="details">
<span id="author" class="author">LoÃ¯c Ledoyen</span><br>
<span id="email" class="email"><a href="mailto:loic.ledoyen@gmail.com">loic.ledoyen@gmail.com</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Java 201</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_rappels_sur_les_outils">1. Rappels sur les outils</a>
<ul class="sectlevel2">
<li><a href="#_git">1.1. Git</a></li>
<li><a href="#_concepts_utilisÃ©s_par_git">1.2. Concepts utilisÃ©s par Git</a></li>
<li><a href="#_maven">1.3. Maven</a></li>
<li><a href="#_junit">1.4. JUnit</a></li>
</ul>
</li>
<li><a href="#_le_dÃ©couplage_un_concept_valide_a_toutes_les_Ã©chelles">2. Le DÃ©couplage, un concept valide a toutes les Ã©chelles</a>
<ul class="sectlevel2">
<li><a href="#_Ã _lÃ©chelle_dune_classe_java">2.1. Ã lâÃ©chelle dâune classe Java</a></li>
<li><a href="#_a_lÃ©chelle_dune_application">2.2. A lâÃ©chelle dâune application</a></li>
<li><a href="#_a_lÃ©chelle_dun_ensemble_dapplication">2.3. A lâÃ©chelle dâun ensemble dâapplication</a></li>
</ul>
</li>
<li><a href="#_quelques_types_darchitecture">3. Quelques types dâarchitecture</a>
<ul class="sectlevel2">
<li><a href="#_n_tiers">3.1. N-tiers</a></li>
<li><a href="#_hexagonale">3.2. Hexagonale</a></li>
<li><a href="#_monolithique_vs_micro_services">3.3. Monolithique vs micro-services</a></li>
</ul>
</li>
<li><a href="#_dimensionnement_considÃ©rations_relatives">4. Dimensionnement &amp; considÃ©rations relatives</a>
<ul class="sectlevel2">
<li><a href="#_identifier_les_spofs">4.1. Identifier les SPOFs</a></li>
<li><a href="#_identifier_les_points_de_contention">4.2. Identifier les points de contention</a></li>
<li><a href="#_rÃ©partir_la_charge">4.3. RÃ©partir la charge</a></li>
<li><a href="#_exemple_dÃ©volution_darchitecture">4.4. Exemple dâÃ©volution dâarchitecture</a></li>
</ul>
</li>
<li><a href="#_documenter_larchitecture">5. Documenter lâarchitecture</a>
<ul class="sectlevel2">
<li><a href="#_readme">5.1. README</a></li>
<li><a href="#_c4">5.2. C4</a></li>
<li><a href="#_adr_architectural_decision_records">5.3. ADR (Architectural Decision Records)</a></li>
<li><a href="#_documentation_des_apis">5.4. Documentation des APIs</a></li>
<li><a href="#_bdd_et_atdd">5.5. BDD et ATDD</a></li>
</ul>
</li>
<li><a href="#_techniques_bonnes_pratiques">6. Techniques &amp; bonnes pratiques</a>
<ul class="sectlevel2">
<li><a href="#_kiss_yagni_dry">6.1. KISS, YAGNI &amp; DRY</a></li>
<li><a href="#_logs">6.2. Logs</a></li>
<li><a href="#_supervision">6.3. Supervision</a></li>
</ul>
</li>
<li><a href="#_conclusion">Conclusion</a></li>
<li><a href="#_pour_aller_plus_loin">Pour aller plus loin</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
Architecture is about the important stuff.<br>
Whatever that is.
</blockquote>
<div class="attribution">
&#8212; Ralph Johnson
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>It means that the heart of thinking architecturally about software is to decide what is important, (i.e. what is architectural), and then expend energy on keeping those architectural elements in good condition.<br>
For a developer to become an architect, they need to be able to recognize what elements are important, recognizing what elements are likely to result in serious problems should they not be controlled.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Martin Fowler
</div>
</div>
<div class="paragraph">
<p>Un logiciel doit rÃ©pondre Ã  plusieurs objectifs dÃ©pendant de son contexte.<br>
Parmi ces objectifs on retrouve :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MaintenabilitÃ© / Ã©volutivitÃ©</p>
</li>
<li>
<p>TestabilitÃ©</p>
</li>
<li>
<p>FiabilitÃ© / Robustesse / tolÃ©rance Ã  la panne</p>
</li>
<li>
<p>ScalabilitÃ©</p>
</li>
<li>
<p>SÃ©curitÃ©</p>
</li>
<li>
<p>Performance</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Lâarchitecture logicielle est lâensemble des moyens techniques utilisÃ©s pour rÃ©pondre Ã  ces objectifs tout en satisfaisant aux contraintes non techniques du projet.</p>
</div>
<div class="paragraph">
<p>Tous les objectifs ne peuvent pas Ãªtre atteint dâun coup, et lâarchitecture logicielle est le compromis qui convient le mieux pour atteindre les objectifs prioritaires dans le contexte du projet.</p>
</div>
<div class="paragraph">
<p>Les facteurs peuvent Ãªtre multiples :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DÃ©lais courts (<em>deadline</em>)</p>
</li>
<li>
<p>Budget limitÃ©</p>
</li>
<li>
<p>Certification de sÃ©curitÃ© nÃ©cessaire</p>
</li>
<li>
<p>Connexion Ã  un systÃ¨me <em>historique</em> utilisant une technologie spÃ©cifique</p>
</li>
<li>
<p>Etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Lâordre de prioritÃ© de ces objectifs doit Ãªtre dÃ©cidÃ© avec lâensemble des acteurs du projet et rÃ©ajustÃ© pÃ©riodiquement afin de suivre lâÃ©volution du projet dans le temps.<br>
Il sâagit dâun partenariat.</p>
</div>
<div class="paragraph">
<p>LâÃ©quipe de dÃ©veloppement met en oeuvre les principes dâarchitecture logicielle pour rÃ©pondre au mieux aux objectifs du projet.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_rappels_sur_les_outils">1. Rappels sur les outils</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_git">1.1. Git</h3>
<div class="paragraph">
<p>Git est un SCM (<strong>S</strong>ource <strong>C</strong>ode <strong>M</strong>anagement tool) dÃ©centralisÃ©.</p>
</div>
<div class="paragraph">
<p>On Ã©tend par dÃ©centralisÃ© le fait quâil peut y avoir plusieurs instances dâun mÃªme dÃ©pÃ´t sur des serveurs diffÃ©rents.<br>
Typiquement, dans le monde de lâopen-source, quand un individu externe Ã  lâorganisation souhaite contribuer au code dâun dÃ©pÃ´t, il en fait une copie, travaille sur sa copie, puis propose le code de sa copie pour intÃ©gration sur le dÃ©pÃ´t <em>officiel</em>.</p>
</div>
<div class="paragraph">
<p>Git est aujourdâhui trÃ¨s rÃ©pandu, mais fait suite historiquement Ã  dâautres SCMs (CVS, SVN, Mercurial, etc.).<br>
Tous ces outils fonctionnent par diffÃ©rentiel (patch) pour permettre de restaurer une version prÃ©cÃ©dente, ou encore de travailler sur une version parallÃ¨le qui pourra plus tard Ãªtre rÃ©incorporÃ©e dans la version principale.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/git_sample.png" alt="git sample">
</div>
</div>
<div class="paragraph">
<p>Voici le vocabulaire consacrÃ© :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>commit</strong> : une rÃ©vision / version contenant des modifications de code</p>
</li>
<li>
<p><strong>branch</strong> : un fil de modification, une suite de rÃ©visions</p>
</li>
<li>
<p><strong>tag</strong> : alias pour une version spÃ©cifique, souvent utilisÃ© pour marquer une version applicative (1.0.25 par exemple)</p>
</li>
<li>
<p><strong>merge</strong> : fusion dâune branche dans une autre</p>
</li>
<li>
<p><strong>checkout</strong> : rÃ©cupÃ©rer le code dâun serveur distant dans une version spÃ©cifique</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_quelques_commandes_utiles">1.1.1. Quelques commandes utiles</h4>
<div class="ulist">
<ul>
<li>
<p>Initialiser un dÃ©pÃ´t</p>
<div class="ulist">
<ul>
<li>
<p><code>git clone &lt;url&gt;</code> : copie un dÃ©pÃ´t distant existant en local</p>
</li>
<li>
<p>Ou <code>git init</code> : transforme le dossier courant en dÃ©pÃ´t local. Un dÃ©pÃ´t distant pourra Ãªtre indiquÃ© par la suite avec <code>git remote add origin &lt;url&gt;</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Mettre Ã  jour</p>
<div class="ulist">
<ul>
<li>
<p><code>git fetch --all --prune</code> : rÃ©cupÃ¨re les changements du dÃ©pÃ´t distant</p>
</li>
<li>
<p><code>git pull</code> : fusionne les changements distants avec les fichiers locaux</p>
</li>
<li>
<p><code>git rebase origin/&lt;current-branch&gt;</code> : dÃ©place les commits locaux aprÃ¨s ceux ayant Ã©tÃ© poussÃ©s sur le dÃ©pÃ´t distant (et sur la mÃªme branche)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Changer de branche</p>
<div class="ulist">
<ul>
<li>
<p><code>git checkout &lt;branch&gt;</code> : positionne les sources courantes sur la derniÃ¨re version de <code>&lt;branch&gt;</code></p>
</li>
<li>
<p><code>git branch -b &lt;branch&gt;</code> : crÃ©e une branche de nom <code>&lt;branch&gt;</code> dont le point de dÃ©part est le commit courant</p>
</li>
</ul>
</div>
</li>
<li>
<p>Observer les changements</p>
<div class="ulist">
<ul>
<li>
<p><code>git status</code> : affiche les diffÃ©rences entre les dÃ©pÃ´ts local et distant</p>
</li>
<li>
<p><code>git log --oneline -n 15</code> : affiche les 15 derniers commits de la branche courante (avec leurs hash)</p>
</li>
<li>
<p><code>git diff --stat</code> : affiche un rÃ©sumÃ© des changements</p>
</li>
<li>
<p><code>git diff --word-diff=color &lt;file&gt;</code> : affiche les changements effectuÃ©s sur le fichier <code>&lt;file&gt;</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Apporter des changements</p>
<div class="ulist">
<ul>
<li>
<p><code>git add &lt;file&gt;</code> : ajoute le fichier <code>&lt;file&gt;</code> Ã  lâ<em>index</em></p>
</li>
<li>
<p><code>git add .</code> : ajoute tous les fichiers modifiÃ©s Ã  lâ<em>index</em> (traverse les rÃ©pertoires)</p>
</li>
<li>
<p><code>git reset &lt;file&gt;</code> : enlÃ¨ve le fichier <code>&lt;file&gt;</code> de lâ<em>index</em></p>
</li>
<li>
<p><code>git commit -m "&lt;title&gt;"</code> : crÃ©e un commit avec toutes les modifications dans lâ<em>index</em> avec le titre <code>&lt;title&gt;</code></p>
</li>
<li>
<p><code>git commit --fixup &lt;hash&gt;</code> : crÃ©e un commit de correction dâun commit existant de hash <code>&lt;hash&gt;</code> avec toutes les modifications dans lâ<em>index</em></p>
</li>
<li>
<p><code>git rebase -i --autosquash &lt;hash&gt;</code> : initie un rebase interactif et dÃ©place et marque les commits de correction pour les fusionner, jusquâau commit de hash <code>&lt;hash&gt;</code> exclu</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Source : <a href="https://git-scm.com/docs" class="bare">https://git-scm.com/docs</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_pour_les_utilisateurs_de_windows">1.1.2. Pour les utilisateurs de Windows</h4>
<div class="paragraph">
<p>Git est sensible au bit dâexecution des fichiers (<code>chmod +x</code>).<br>
<strong>Windows</strong> ne gÃ©rant pas de la mÃªme faÃ§on les permissions sur les fichiers quâUnix, il est recommandÃ© de dÃ©sactiver cette sensibilitÃ© avec <code>git config core.fileMode false</code><br>
Pour expliciter le fait quâun fichier soit executable : <code>git update-index --chmod=+x &lt;file&gt;</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_utilisÃ©s_par_git">1.2. Concepts utilisÃ©s par Git</h3>
<div class="paragraph">
<p>On appelle <strong>remotes</strong> les serveurs distants configurÃ©s sur une copie locale.<br>
Le remote par dÃ©faut est appelÃ© <strong>origin</strong>.<br>
Dans le cas oÃ¹ le dÃ©pÃ´t a Ã©tÃ© clonÃ© (et non initialisÃ©) <strong>origin</strong> pointe sur lâurl utilisÃ©e lors du <em>clone</em>.</p>
</div>
<div class="paragraph">
<p>Git utilise une base de donnÃ©es (rÃ©pertoire <strong>.git</strong>) qui contient lâarbre de toutes les modifications de chaque branche.<br>
Celle-ci contient Ã©galement la version des diffÃ©rents remotes.<br>
Les branches en question sont accessibles avec le nom : <strong>&lt;remote_name&gt;/&lt;branch_name&gt;</strong>.<br>
Par exemple <strong>origin/main</strong> est la branche <strong>main</strong> telle que le serveur <strong>origin</strong> la connaissait lors de la derniÃ¨re synchronisation de la base de donnÃ©e.<br>
Il est tout Ã  fait possible dâavoir une (et une seule) version locale et plusieurs versions distantes dâune mÃªme branche diffÃ©rente.<br>
Ce sera lors dâun push (envoi de lâhistorique local vers un remote) que ces versions deviendront les mÃªmes.</p>
</div>
<div class="paragraph">
<p>La copie de travail (<strong>working copy</strong>) sont les fichiers contenus dans un dÃ©pÃ´t local.<br>
Il est possible de les modifier, dâen ajouter ou dâen supprimer, sans modifier les versions connues par Git.<br>
Il sera, dans tous les cas, possible de revenir Ã  une version connue par Git, grÃ¢ce Ã  la base de donnÃ©es.</p>
</div>
<div class="paragraph">
<p>Afin de considÃ©rer les modifications opÃ©rÃ©es sur la copie de travail pour Ãªtre historisÃ©es (embarquÃ©es dans un <em>commit</em>), il est nÃ©cessaire de les indexer.<br>
Lâ<strong>index</strong> est lâespace accueillant les modifications qui seront comprises dans un commit.<br>
Il est possible dây ajouter des Ã©lÃ©ments (ajout, suppression ou modification de fichier) avec la commande <code>add</code>.<br>
Y enlever des Ã©lÃ©ments se fait avec la commande <code>reset</code>.<br>
Enfin la commande <code>status</code> fait apparaÃ®tre dans des couleurs diffÃ©rentes les changements qui sont indexÃ©s et ceux qui ne le sont pas.<br>
Par dÃ©faut les changements indexÃ©s sont en vert et les autres en rouge.<br>
RÃ©aliser un <em>commit</em> (commande <code>commit</code>), embarquera toutes les modifications vertes.</p>
</div>
<div class="sect3">
<h4 id="_rebase">1.2.1. Rebase</h4>
<div class="paragraph">
<p>Une des fonctionnalitÃ©s qui dÃ©marque Git de ses prÃ©dÃ©cesseurs est le <strong>rebase</strong>.</p>
</div>
<div class="paragraph">
<p>Le <strong>rebase</strong> peut Ãªtre utilisÃ© pour remettre Ã  jour une branche quand la branche dâorigine a changÃ©.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">git fetch <span class="nt">--all</span> <span class="nt">--prune</span> # <b class="conum">(1)</b>
git log <span class="nt">--one-line</span> <span class="nt">-n</span> 10 # <b class="conum">(2)</b>
git rebase origin/main # <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>RÃ©cupÃ¨re la base de donnÃ©e du remote par dÃ©faut (<strong>origin</strong>) pour toutes les branches</p>
</li>
<li>
<p>Affiche les dix derniers commits de la branche courante</p>
</li>
<li>
<p>Modifie lâhistorique de la branche courante en mettant les commits rÃ©alisÃ©s aprÃ¨s la base Ã  la suite des derniers commits de la branche <code>main</code> telle quâelle est connue par <strong>origin</strong></p>
</li>
</ol>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/git_rebase.png" alt="git rebase">
</div>
</div>
<div class="paragraph">
<p>Le <strong>rebase</strong> peut Ã©galement Ãªtre utilisÃ© en mode <em><strong>interactif</strong></em> pour modifier son historique local :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ajouter des modifications dans un commit</p>
</li>
<li>
<p>Changer le nom dâun commit</p>
</li>
<li>
<p>Fusionner des commits</p>
</li>
<li>
<p>Supprimer des commits</p>
</li>
<li>
<p>RÃ©-ordonner des commits</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Conseil</div>
</td>
<td class="content">
Ne pas utiliser le rebase sur une branche partagÃ©e par plusieurs dÃ©veloppeurs, et encore moins <code>main</code>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_maven">1.3. Maven</h3>
<div class="paragraph">
<p>Maven est un outil de construction de projet (Build Automation tool) autour de la JVM.</p>
</div>
<div class="paragraph">
<p>Il permet entre autre dâorchestrer :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gestion des dÃ©pendances</p>
</li>
<li>
<p>Compilation des sources</p>
</li>
<li>
<p>Lancement des tests</p>
</li>
<li>
<p>GÃ©nÃ©ration de la documentation</p>
</li>
<li>
<p>Assemblage des binaires</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sa grande extensibilitÃ© lui permet de sâadapter Ã  diffÃ©rents languages (Java, Scala, Kotlin, etc.) et Ã  diffÃ©rents scÃ©narios (intÃ©gration continue, gÃ©nÃ©ration de code, dÃ©ploiement, etc.).</p>
</div>
<div class="sect3">
<h4 id="_structure_dun_projet">1.3.1. Structure dâun projet</h4>
<div class="paragraph">
<p>Maven propose de baser lâorganisation dâun projet sur des conventions (nommage, structure des rÃ©pertoires, etc.) plutÃ´t que sur de la configuration pure comme ses prÃ©dÃ©cesseurs (Make, Ant, etc. ).</p>
</div>
<div class="paragraph">
<p>Cette structure est composÃ©e de</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Un fichier pom.xml qui contient toutes les informations nÃ©cessaires Ã  Maven pour construire le projet. Sa structure minimale est la suivante</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 1. Fichier pom.xml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>
         <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;groupId&gt;</span>com.mycompany<span class="nt">&lt;/groupId&gt;</span> &lt;!--<b class="conum">(1)</b>--&gt;
    <span class="nt">&lt;artifactId&gt;</span>my-app<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>

    <span class="nt">&lt;properties&gt;</span> &lt;!--<b class="conum">(2)</b>--&gt;
        <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
        <span class="nt">&lt;project.reporting.outputEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.reporting.outputEncoding&gt;</span>
        <span class="nt">&lt;maven.compiler.source&gt;</span>17<span class="nt">&lt;/maven.compiler.source&gt;</span>
        <span class="nt">&lt;maven.compiler.target&gt;</span>17<span class="nt">&lt;/maven.compiler.target&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Le triplet <code>groupId</code>, <code>artifactId</code> et <code>version</code> sont les coordonnÃ©es qui identifient un projet Maven et permettent des dÃ©pendances avec dâautres</p>
</li>
<li>
<p>Section optionnelle, permettant de fixer lâencodage et la version de Java utilisÃ©e pour Ã©viter des conflits par la suite</p>
</li>
</ol>
</div>
<div class="ulist">
<ul>
<li>
<p>Un rÃ©pertoire <strong>src</strong> qui contiendra tous les fichiers que lâon souhaite conserver dans le SCM</p>
<div class="ulist">
<ul>
<li>
<p>Dans <strong>src</strong> on retrouve deux rÃ©pertoires : <strong>main</strong> et <strong>test</strong> qui contiennent respectivement le code de production, et le code de test (code qui ne sera pas inclus dans les binaires produits lors de la phase de <strong><em>packaging</em></strong>)</p>
<div class="ulist">
<ul>
<li>
<p>Dans ces deux rÃ©pertoires, on trouve un rÃ©pertoire du nom du langage utilisÃ©, dans cet exemple, <strong>java</strong></p>
<div class="ulist">
<ul>
<li>
<p>Enfin dans ce<strong>s</strong> rÃ©pertoire<strong>s</strong> <strong>java</strong> (ou <strong>groovy</strong>, etc.), on retrouve le code. Ce code est organisÃ© en packages, eux-mÃªmes Ã©tant constituÃ©s de rÃ©pertoires</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/maven_structure.png" alt="maven structure">
</div>
<div class="title">Figure 1. Structure dâun projet Maven</div>
</div>
</div>
<div class="sect3">
<h4 id="_cycle_de_vie_dun_projet_maven">1.3.2. Cycle de vie dâun projet Maven</h4>
<div class="paragraph">
<p>Par dÃ©faut Maven utilise un cycle de vie permettant Ã  la grande majoritÃ© des projets dâÃªtre construit avec peu de configuration.</p>
</div>
<div class="paragraph">
<p>Les principales <strong>phases</strong> sont :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>clean</strong> : nettoie les fichiers compilÃ©s ou gÃ©nÃ©rÃ©s</p>
</li>
<li>
<p><strong>compile</strong> : compile les sources <em>principales (main)</em></p>
</li>
<li>
<p><strong>test-compile</strong> : compile les sources de <em>test</em></p>
</li>
<li>
<p><strong>test</strong> : lance les tests</p>
</li>
<li>
<p><strong>package</strong> : construit le binaire (<strong>jar</strong> par dÃ©faut)</p>
</li>
<li>
<p><strong>install</strong> : place le binaire dans le dÃ©pÃ´t Maven local</p>
</li>
<li>
<p><strong>deploy</strong> : place le binaire dans un dÃ©pÃ´t Maven distant</p>
</li>
<li>
<p><strong>site</strong> : gÃ©nÃ¨re la documentation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Chaque phase est associable Ã  un ou plusieurs <strong>plugins</strong>, ce qui rend Maven trÃ¨s extensible.</p>
</div>
<div class="paragraph">
<p>Voici les associations par dÃ©faut :</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/maven_circle.png" alt="maven circle">
</div>
</div>
<div class="paragraph">
<p>Des plugins sont fournis directement par Maven, comme le <strong>maven-clean-plugin</strong>, qui supprime les fichiers compilÃ©s et gÃ©nÃ©rÃ©s.</p>
</div>
<div class="paragraph">
<p>Dâautres sont crÃ©Ã©s par la communautÃ© sans voir besoin de modifier lâoutil. Par exemple :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>cukedoctor-maven-plugin</strong> : produit une version HTML du rÃ©sultat des tests Cucumber</p>
</li>
<li>
<p><strong>sonar-maven-plugin</strong> : analyse le code avec diffÃ©rents outils (PMD, Checkstyle, JaCoCo, etc.) et publie les rÃ©sultats vers un serveur Sonar</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Source : <a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html" class="bare">https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_balises_de_configuration">1.3.3. Balises de configuration</h4>
<div class="paragraph">
<p>Toutes les balises doivent Ãªtre contenues dans le bloc <code>&lt;project&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Dans les balises notables, on retrouve :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>properties</code> : cette balise contient des propriÃ©tÃ©s (clÃ© et valeur) qui peuvent Ãªtre utilisÃ©es par la suite, soit par convention par les plugins, soit explicitement avec  lâÃ©criture <code>${my-property}</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;my-test-lib.version&gt;</span>1.2<span class="nt">&lt;/my-test-lib.version&gt;</span>
<span class="nt">&lt;/properties&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>dependencies</code> : cette balise contient toutes les dÃ©pendances dâun projet sur dâautres (internes, externes, frameworks, bibliothÃ¨ques, etc.)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span> &lt;!--<b class="conum">(1)</b>--&gt;
        <span class="nt">&lt;groupId&gt;</span>com.mycompany<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>my-lib<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.45.3<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.mycompany<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>my-test-lib<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${my-test-lib.version}<span class="nt">&lt;/version&gt;</span> &lt;!--<b class="conum">(2)</b>--&gt;
        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span> &lt;!--<b class="conum">(3)</b>--&gt;
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Le bloc <code>dependencies</code> est constituÃ© de blocs <code>dependency</code> (singulier), chacun contenant les coordonnÃ©es dâune dÃ©pendance</p>
</li>
<li>
<p>La valeur de la version fait rÃ©fÃ©rence Ã  la propriÃ©tÃ© <code>my-test-lib.version</code>, donc <code>1.2</code></p>
</li>
<li>
<p>Ce second bloc est indiquÃ© avec le <strong><em>scope</em></strong> <code>test</code>, cette dÃ©pendance ne sera donc disponible que pour le code de test</p>
</li>
</ol>
</div>
<div class="ulist">
<ul>
<li>
<p><code>build/plugins</code> : cette balise contient tous les plugins utilisÃ©s par le projet ainsi que leurs configurations</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
        <span class="nt">&lt;plugin&gt;</span> &lt;!--<b class="conum">(1)</b>--&gt;
            <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span> &lt;!--<b class="conum">(2)</b>--&gt;
            <span class="nt">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.22.2<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;configuration&gt;</span> &lt;!--<b class="conum">(3)</b>--&gt;
                <span class="nt">&lt;failIfNoTests&gt;</span>true<span class="nt">&lt;/failIfNoTests&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
        <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
<span class="nt">&lt;/build&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Ã lâinstar de la balise <code>dependencies</code>, la balise <code>plugins</code> contient des blocs de <code>plugin</code> (singulier)</p>
</li>
<li>
<p>Ici câest le plugin <code>maven-surefire-plugin</code> qui est utilisÃ©. Il sâagit du plugin par dÃ©faut pour lancer les tests. Un plugin est un projet Maven, et Ã  ce titre est rÃ©fÃ©rencÃ© grÃ¢ce Ã  ses coordonnÃ©es (<code>groupId</code>, <code>artifactId</code> et <code>version</code>) comme pour les dÃ©pendances</p>
</li>
<li>
<p>La balise configuration permet de modifier le comportement du plugin, ici le plugin va faire Ã©chouer le build si aucun test nâest trouvÃ©</p>
</li>
</ol>
</div>
<div class="ulist">
<ul>
<li>
<p><code>profiles</code> : cette balise permet dâajouter des pans de configuration qui sont dÃ©sactivables. Un profil peut ajouter des <code>properties</code>, des <code>dependencies</code>, des <code>plugins</code> et mÃªme des <code>modules</code> (utilisÃ©s pour les projets multi-modules)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;profiles&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
        <span class="nt">&lt;id&gt;</span>disable-tests<span class="nt">&lt;/id&gt;</span> &lt;!--<b class="conum">(1)</b>--&gt;
        <span class="nt">&lt;properties&gt;</span>
            <span class="nt">&lt;maven.test.skip&gt;</span>true<span class="nt">&lt;/maven.test.skip&gt;</span>
        <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
<span class="nt">&lt;/profiles&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Balise obligatoire, un profil doit avoir un <code>id</code>, ce qui permet de lâactiver en ligne de commande, par exemple : <code>mvn install -P disable-tests</code></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_junit">1.4. JUnit</h3>
<div class="paragraph">
<p>Java ne propose pas dans le JDK dâoutils pour construire et exÃ©cuter des tests.</p>
</div>
<div class="paragraph">
<p>Maven propose un rÃ©pertoire de source, des phases (compilation &amp; exÃ©cution) et un scope pour gÃ©rer ce code qui nâest pas destinÃ© Ã  la production.<br>
Cependant, Maven ne fourni pas directement dâoutil pour dÃ©clarer ou exÃ©cuter ces tests.</p>
</div>
<div class="paragraph">
<p>Câest lÃ  quâentrent en jeu les frameworks de tests.<br>
Il en existe plusieurs, et JUnit est aujourdâhui le plus rÃ©pandu.</p>
</div>
<div class="sect3">
<h4 id="_utilisation_de_lapi_de_junit_jupiter">1.4.1. Utilisation de lâAPI de JUnit-Jupiter</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">class</span> <span class="nc">CalculatorTest</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Calculator</span> <span class="n">calculator</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Calculator</span><span class="o">();</span>

    <span class="nd">@Test</span> // <b class="conum">(1)</b>
    <span class="kt">void</span> <span class="nf">simple_division</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">calculator</span><span class="o">.</span><span class="na">divide</span><span class="o">(</span><span class="mi">8</span><span class="o">).</span><span class="na">by</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span> // <b class="conum">(2)</b>

        <span class="nc">Assertions</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span><span class="n">result</span><span class="o">)</span> // <b class="conum">(3)</b>
            <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="s">"division of 8 by 2"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span> // <b class="conum">(4)</b>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">division_by_zero_should_throw</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Assertions</span><span class="o">.</span><span class="na">assertThatExceptionOfType</span><span class="o">(</span><span class="nc">IllegalArgumentException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> // <b class="conum">(5)</b>
            <span class="o">.</span><span class="na">isThrownBy</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">calculator</span><span class="o">.</span><span class="na">divide</span><span class="o">(</span><span class="mi">3</span><span class="o">).</span><span class="na">by</span><span class="o">(</span><span class="mi">0</span><span class="o">))</span> // <b class="conum">(6)</b>
            <span class="o">.</span><span class="na">withMessage</span><span class="o">(</span><span class="s">"Cannot divide by zero"</span><span class="o">);</span> // <b class="conum">(7)</b>
    <span class="o">}</span>

    <span class="nd">@ParameterizedTest</span> // <b class="conum">(8)</b>
    <span class="nd">@CsvSource</span><span class="o">({</span>
        <span class="s">"0, 3, 3"</span><span class="o">,</span>
        <span class="s">"3, 4, 7"</span>
    <span class="o">})</span> // <b class="conum">(9)</b>
    <span class="kt">void</span> <span class="nf">addition_cases</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">,</span> <span class="kt">int</span> <span class="n">expectedResult</span><span class="o">)</span> <span class="o">{</span> // <b class="conum">(10)</b>
        <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">calculator</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">a</span><span class="o">).</span><span class="na">and</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>

        <span class="nc">Assertions</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span><span class="n">result</span><span class="o">)</span> // <b class="conum">(3)</b>
            <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="s">"addition of "</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="s">" and "</span> <span class="o">+</span> <span class="n">b</span><span class="o">)</span>
            <span class="o">.</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">expectedResult</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>MÃ©thode identifiÃ©e comme un test car marquÃ©e avec lâannotation <code>org.junit.jupiter.api.Test</code></p>
</li>
<li>
<p>ÃlÃ©ment dÃ©clencheur, du code de production est exÃ©cutÃ©</p>
</li>
<li>
<p>On vÃ©rifie le rÃ©sultat du code de production (ici avec la bibliothÃ¨que <strong>AssertJ</strong>)</p>
</li>
<li>
<p>Ces trois lignes forme une seule expression, le compilateur ne tenant pas compte des sauts de ligne. Ce genre dâÃ©criture est appelÃ© <strong>fluent interface</strong> et repose sur des appels consÃ©cutifs de mÃ©thodes de sorte Ã  former des phrases. Ici littÃ©ralement : vÃ©rifie que la variable <code>result</code> en tant que "division of 8 by 2" est Ã©gal Ã  4</p>
</li>
<li>
<p>Type diffÃ©rent de vÃ©rification, ici on vÃ©rifie quâune erreur est produite, le test sera non passant si aucune erreur nâest produite ou si le type de lâerreur est diffÃ©rent de celui indiquÃ©</p>
</li>
<li>
<p>Une fonction est passÃ©e Ã  lâAPI de vÃ©rification, elle sera exÃ©cutÃ©e par la bibliothÃ¨que, dans un bloc <code>try / catch</code></p>
</li>
<li>
<p>VÃ©rification du message de lâerreur, si le message ne correspond pas, le test sera non passant</p>
</li>
<li>
<p>MÃ©thode identifiÃ©e comme un test paramÃ©trÃ©, elle sera exÃ©cutÃ©e autant de fois quâil y a de jeux de donnÃ©es. La mÃ©thode dans cet exemple sera exÃ©cutÃ©e 2 fois.</p>
</li>
<li>
<p>Le jeu de donnÃ©e, ici passÃ© comme un CSV (Comma Separated Values), dâautres sources de donnÃ©es sont possibles.</p>
</li>
<li>
<p>La mÃ©thode prend donc des paramÃ¨tres dont le nombre correspond aux donnÃ©es dans les jeux de donnÃ©es. Lâordre des paramÃ¨tres doit correspondre Ã  lâordre des donnÃ©es.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_comment_junit_fonctionne_avec_maven">1.4.2. Comment JUnit fonctionne avec Maven</h4>
<div class="paragraph">
<p><strong>JUnit-Jupiter</strong> dÃ©fini plusieurs choses :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Une API pour dÃ©clarer une mÃ©thode comme Ã©tant un test (<code>@Test</code>, etc.)</p>
</li>
<li>
<p>Un moteur dâexÃ©cution qui sait dÃ©tecter les tests et les lancer</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JUnit fourni Ã©galement un lanceur de moteur(s) dâexÃ©cution : <strong>junit-platform-launcher</strong></p>
</div>
<div class="paragraph">
<p>Enfin, le plugin <strong>maven-surefire-plugin</strong> "sait" se connecter (entre autres) Ã  ce <em>launcher</em> (depuis la version 2.22.0).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Pour rÃ©sumer :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>La phase <strong>test</strong> de Maven est associÃ© au plugin <strong>maven-surefire-plugin</strong></p>
</li>
<li>
<p>Ce plugin peut lancer <strong>junit-platform-launcher</strong> (si cette bibliothÃ¨que est prÃ©sente sur le classpath)</p>
</li>
<li>
<p>Ce <em>launcher</em> peut lancer les moteurs dâexÃ©cutions construits avec lâAPI de moteur dâexÃ©cution <strong>junit-platform-engine</strong>, notamment <strong>JUnit-Jupiter</strong></p>
</li>
<li>
<p><strong>JUnit-Jupiter</strong> sait dÃ©tecter et lancer les tests dÃ©clarÃ©s avec son API</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_un_peu_dhistoire">1.4.3. Un peu dâhistoire</h4>
<div class="paragraph">
<p>JUnit est un vieux framework (1997) et celui-ci a beaucoup Ã©voluÃ© au fil des versions de Java.<br>
La version 4, arrivÃ©e en 2006 (aprÃ¨s Java 1.5) a longtemps Ã©tÃ© utilisÃ©e, du fait de la simplicitÃ© dâÃ©criture apportÃ©e par le support des annotations (<code>@Test</code>).<br>
En 2015, une campagne de financement participatif est lancÃ©e pour crÃ©er JUnit<strong>5</strong>, une rÃ©Ã©criture totale du framework.</p>
</div>
<div class="paragraph">
<p>Le constat de lâÃ©quipe est que le cÃ´tÃ© monolithique qui a jusque-lÃ  prÃ©valu, a amenÃ© des dÃ©rives dans lâAPI du framework, qui est Ã  la fois permissive et trÃ¨s complexe.</p>
</div>
<div class="paragraph">
<p>En effet, si le point de dÃ©part dâun test est conventionnellement une mÃ©thode, des plugins voient le jour pour changer ce paradigme (Cucumber, etc.), oÃ¹ un test peut-Ãªtre un paragraphe dans un fichier texte.</p>
</div>
<div class="paragraph">
<p>Par ailleurs, mÃªme sâil existe plusieurs points dâextension dans cette version 4, le plus utilisÃ© est le <code>Runner</code>, qui a le dÃ©faut de ne pas Ãªtre composable.<br>
Cela demande aux Ã©quipes fournissant des plugins de fournir des outils qui fonctionnent depuis plusieurs points dâextensions (<code>Runner</code>, <code>Rule</code>, initialisation dans une mÃ©thode de <code>setUp</code>, etc.) pour contourner ce dÃ©faut</p>
</div>
<div class="paragraph">
<p>LâÃ©quipe de JUnit5 estime que chaque paradigme devrait avoir sa propre API et son propre moteur dâexÃ©cution, pour que le code soit plus spÃ©cifique, et donc plus simple.</p>
</div>
<div class="paragraph">
<p>Lâarchitecture rÃ©sultante est la suivante :</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/junit5_architecture.png" alt="junit5 architecture">
</div>
</div>
<div class="paragraph">
<p><strong>JUnit-platform</strong> est un framework pour construire (et lancer) des moteurs dâexÃ©cutions.</p>
</div>
<div class="paragraph">
<p><strong>JUnit-Vintage</strong> est un moteur dâexÃ©cution qui est compatible avec lâAPI de JUnit4.</p>
</div>
<div class="paragraph">
<p><strong>JUnit-Jupiter</strong> est le moteur dâexÃ©cution dâune nouvelle API qui profite (entre autres) de points dâextension multiples et composables.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_le_dÃ©couplage_un_concept_valide_a_toutes_les_Ã©chelles">2. Le DÃ©couplage, un concept valide a toutes les Ã©chelles</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
Jâai rÃ©pondu Ã  leur problÃ¨me en leur proposant dâajouter un nouveau niveau dâindirection.
</blockquote>
<div class="attribution">
&#8212; un architecte qui passait par lÃ 
</div>
</div>
<div class="paragraph">
<p>Lâobjectif qui prÃ©vaut sur tous les autres est la <strong>maintenabilitÃ©</strong>.<br>
En cas de problÃ¨me, liÃ© Ã  la performance, Ã  la sÃ©curitÃ© ou au fonctionnement dâun logiciel, la solution doit tendre vers un impact minimum.<br>
Plus le changement de code est important, et plus le risque augmente, et plus le temps nÃ©cessaire Ã  la mise en production se rallonge.<br>
Une correction (mais cela vaut pour une Ã©volution Ã©galement) doit comporter le moins de risque possible.</p>
</div>
<div class="paragraph">
<p>RÃ©duire lâinertie entre la conception et la mise en production, câest augmenter la maitrise et la confiance de lâÃ©quipe dans le code produit.</p>
</div>
<div class="sect2">
<h3 id="_Ã _lÃ©chelle_dune_classe_java">2.1. Ã lâÃ©chelle dâune classe Java</h3>
<div class="sect3">
<h4 id="_exemple_1_Ã©tat_interne_diffÃ©rent_du_contrat_public">2.1.1. Exemple 1 : Ãtat interne diffÃ©rent du contrat public</h4>
<div class="paragraph">
<p>ConsidÃ©rant cette classe :</p>
</div>
<div class="listingblock">
<div class="title">Listing 2. Fichier TrafficLight.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">class</span> <span class="nc">TrafficLight</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">color</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setColor</span><span class="o">(</span><span class="kt">int</span> <span class="n">newColor</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">color</span> <span class="o">=</span> <span class="n">newColor</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getColor</span><span class="o">()</span> <span class="o">{</span> // <b class="conum">(1)</b>
        <span class="k">return</span> <span class="n">color</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Changer le type de la reprÃ©sentation interne (<code>int</code>) demandera dâadapter lâensemble du code qui utilise cette classe</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>La classe pourrait Ãªtre rÃ©Ã©crite de faÃ§on Ã  <span class="underline">dÃ©coupler</span> :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dâune part, la reprÃ©sentation interne de lâÃ©tat de cet objet (un <code>int</code>)</p>
</li>
<li>
<p>dâautre part, le contrat <code>public</code> utilisable par les autres classes</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 3. Fichier TrafficLight.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">class</span> <span class="nc">TrafficLight</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">color</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">Color</span> <span class="nf">nextState</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">color</span> <span class="o">=</span> <span class="o">(</span><span class="n">color</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">%</span> <span class="mi">3</span><span class="o">;</span>
        <span class="k">return</span> <span class="nc">Color</span><span class="o">.</span><span class="na">values</span><span class="o">()[</span><span class="n">color</span><span class="o">];</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Color</span> <span class="o">{</span>
        <span class="no">GREEN</span><span class="o">,</span>
        <span class="no">ORANGE</span><span class="o">,</span>
        <span class="no">RED</span><span class="o">,</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_exemple_2_paramÃ¨tres_de_mÃ©thode_dont_les_types_correspondent_au_domaine">2.1.2. Exemple 2 : ParamÃ¨tres de mÃ©thode dont les types correspondent au domaine</h4>
<div class="paragraph">
<p>ConsidÃ©rant cette interface :</p>
</div>
<div class="listingblock">
<div class="title">Listing 4. Fichier PersonRepository.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">interface</span> <span class="nc">PersonRepository</span> <span class="o">{</span>

    <span class="kt">void</span> <span class="nf">savePerson</span><span class="o">(</span><span class="nc">String</span> <span class="n">firstname</span><span class="o">,</span> <span class="nc">String</span> <span class="n">lastname</span><span class="o">,</span> <span class="kt">int</span> <span class="n">birthYear</span><span class="o">,</span> <span class="kt">int</span> <span class="n">birthMonth</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ã lâusage, il est simple dâinverser un paramÃ¨tre avec un autre car leurs types sont identiques.<br>
Ainsi la compilation ne va pas aider Ã  dÃ©tecter un bug, oÃ¹ le mois et lâannÃ©e sont inversÃ©es par exemple.<br>
Il sâagit dâun <em>couplage de position</em>.<br>
Un meilleur design pourrait Ãªtre :</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. Fichier PersonRepository.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">interface</span> <span class="nc">PersonRepository</span> <span class="o">{</span>

    <span class="nc">Person</span> <span class="nf">savePerson</span><span class="o">(</span><span class="nc">Person</span> <span class="n">person</span><span class="o">);</span>

    <span class="nd">@RecordBuilder</span> // <b class="conum">(1)</b>
    <span class="n">record</span> <span class="nf">Person</span><span class="o">(</span><span class="nc">String</span> <span class="n">firstname</span><span class="o">,</span> <span class="nc">String</span> <span class="n">lastname</span><span class="o">,</span> <span class="nc">YearMonth</span> <span class="n">birthMonth</span><span class="o">)</span> <span class="o">{}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Utilisation de la bibliothÃ¨que <strong>io.soabase.record-builder:record-builder</strong> pour gÃ©nÃ©rer un <em>builder</em> correspondant</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Il est maintenant difficile de se tromper en Ã©crivant :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="nc">PersonBuilder</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">firstname</span><span class="o">(</span><span class="s">"Bobby"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">lastname</span><span class="o">(</span><span class="s">"Singer"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">birthMonth</span><span class="o">(</span><span class="nc">YearMonth</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1962</span><span class="o">,</span> <span class="nc">Month</span><span class="o">.</span><span class="na">DECEMBER</span><span class="o">))</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="n">repository</span><span class="o">.</span><span class="na">savePerson</span><span class="o">(</span><span class="n">person</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_exemple_3_contrat_public_extrait_dans_une_interface">2.1.3. Exemple 3 : Contrat public extrait dans une interface</h4>
<div class="paragraph">
<p>LâintÃ©rÃªt des interfaces est de dÃ©corrÃ©ler le contrat public de lâimplÃ©mentation concrÃ¨te afin de pouvoir :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Substituer un objet par un autre (implÃ©mentant la mÃªme interface) sans modifier le code appelant</p>
</li>
<li>
<p>Cacher lâimplÃ©mentation (mÃ©thodes et champs de lâobjet non prÃ©sents dans lâinterface) dans le code appelant</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Le concept de <code>Logger</code>, largement utilisÃ© dans lâinformatique de gestion est une abstraction pour envoyer un message <em>quelque part</em>.<br>
Du point de vue du code mÃ©tier, peu importe ce "<em>quelque part</em>".</p>
</div>
<div class="paragraph">
<p>Cette abstraction est une interface, par exemple :</p>
</div>
<div class="listingblock">
<div class="title">Listing 6. Fichier Logger.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">interface</span> <span class="nc">Logger</span> <span class="o">{</span>

    <span class="kt">void</span> <span class="nf">log</span><span class="o">(</span><span class="nc">Level</span> <span class="n">level</span><span class="o">,</span> <span class="nc">String</span> <span class="n">message</span><span class="o">);</span>

    <span class="kd">enum</span> <span class="nc">Level</span> <span class="o">{</span>
        <span class="no">INFO</span><span class="o">,</span>
        <span class="no">WARNING</span><span class="o">,</span>
        <span class="no">ERROR</span><span class="o">,</span>
        <span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Et sâutilise de cette maniÃ¨re :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">record</span> <span class="nf">CoffeeShop</span><span class="o">(</span><span class="nc">CoffeeMaker</span> <span class="n">coffeeMaker</span><span class="o">,</span> <span class="nc">Logger</span> <span class="n">logger</span><span class="o">)</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nc">Cup</span> <span class="nf">makeCoffee</span><span class="o">(</span><span class="nc">String</span> <span class="n">firstname</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">coffeeMaker</span><span class="o">.</span><span class="na">isReady</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="nc">Level</span><span class="o">.</span><span class="na">WARN</span><span class="o">,</span> <span class="s">"Tried to make some coffee, but the coffee maker is not ready yet"</span><span class="o">);</span>
            <span class="k">return</span> <span class="nc">Cup</span><span class="o">.</span><span class="na">EMPTY</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nc">Cup</span> <span class="n">cup</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Cup</span><span class="o">(</span><span class="n">firstname</span><span class="o">);</span>
        <span class="n">coffeeMaker</span><span class="o">.</span><span class="na">pourIn</span><span class="o">(</span><span class="n">cup</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="nc">Level</span><span class="o">.</span><span class="na">INFO</span><span class="o">,</span> <span class="s">"Made coffee for "</span> <span class="o">+</span> <span class="n">firstname</span> <span class="o">+</span> <span class="s">", careful itâs hot !"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">cup</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Passer une implÃ©mentation de <code>Logger</code> qui Ã©crit dans</p>
</div>
<div class="ulist">
<ul>
<li>
<p>la sortie standard</p>
</li>
<li>
<p>un fichier</p>
</li>
<li>
<p>une base de donnÃ©es</p>
</li>
<li>
<p>un broker de message</p>
</li>
<li>
<p>un mÃ©lange de toutes ces possibilitÃ©s</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ne changera pas le code de la classe <code>CoffeeShop</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_diffÃ©rentes_formes_de_couplage">2.1.4. DiffÃ©rentes formes de couplage</h4>
<div class="paragraph">
<p>DiffÃ©rentes formes de couplages peuvent Ãªtre retrouvÃ©es ici : <a href="https://connascence.io/" class="bare">https://connascence.io/</a></p>
</div>
<div class="paragraph">
<p>La plupart des couplages peuvent Ãªtre Ã©vitÃ©s en utilisant le code produit en mÃªme temps quâil est crÃ©Ã©.<br>
La technique la plus simple est de suivre les principes du <strong>TDD</strong> (Test Driven Development) ou dÃ©veloppement pilotÃ© par les tests.</p>
</div>
<div class="paragraph">
<p>La pratique du TDD consiste Ã  Ã©crire un test <em>minimal</em> avant dâÃ©crire le code de production <em>minimal</em> qui le fait passer.<br>
Le code produit, rÃ©pondant strictement aux cas de tests rÃ©alisÃ©s, est par construction validÃ© par les tests et utilisable facilement (car dÃ©jÃ  utilisÃ© dans les tests).</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>1) Write <span class="underline">NO</span> production code except to pass a failing test<br>
2) Write only <span class="underline">enough</span> of a test to demonstrate a failure<br>
3) Write only <span class="underline">enough</span> production code to pass the test</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Robert "Uncle Bob" Martin<br>
<cite>Three laws of TDD</cite>
</div>
</div>
<div class="paragraph">
<p>Le fait dâÃ©crire un test minimal est trÃ¨s important car on souhaite, dans la pratique du TDD, Ã©courter au maximum le temps dâune itÃ©ration entre les diffÃ©rentes phases :</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/tdd_red_green_blue.png" alt="tdd red green blue">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_a_lÃ©chelle_dune_application">2.2. A lâÃ©chelle dâune application</h3>
<div class="sect3">
<h4 id="_dÃ©couplage_mÃ©tier">2.2.1. DÃ©couplage mÃ©tier</h4>
<div class="paragraph">
<p>Une application touche la plupart du temps Ã  plusieurs concepts mÃ©tiers distincts.</p>
</div>
<div class="paragraph">
<p>Dans une application de commerce Ã©lectronique on peut retrouver, la gestion du catalogue, le descriptif dâun produit, le dÃ©tail du panier, le paiement, la facturation, etc.</p>
</div>
<div class="paragraph">
<p>Ces domaines ont des liens entre eux, mais peuvent Ã©voluer indÃ©pendamment les uns des autres.<br>
Le code doit retranscrire ces liaisons, mais aussi cette indÃ©pendance.<br>
Le fait de modifier la gestion du panier nâaura (ou ne devrait) pas avoir dâimpact sur le paiement.</p>
</div>
<div class="paragraph">
<p>Mettre en place le dÃ©couplage entre les composants dâune application permet de diminuer le risque en cas de changement, et dâÃ©valuer plus finement les impacts afin de savoir oÃ¹ mettre lâaccent sur les tests par exemple.</p>
</div>
<div class="paragraph">
<p>Ce genre de dÃ©couplage nÃ©cessite une comprÃ©hension profonde des domaines mÃ©tiers en jeu, pour trouver les points dâinterconnexion entre eux et crÃ©er un modÃ¨le dÃ©diÃ© Ã  chaque domaine avec les informations nÃ©cessaires Ã  ces Ã©changes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dÃ©couplage_technique">2.2.2. DÃ©couplage technique</h4>
<div class="paragraph">
<p>De la mÃªme faÃ§on, il est intÃ©ressant de sÃ©parer le code dit <em>mÃ©tier</em> (câest-Ã -dire qui contient les rÃ¨gles mÃ©tiers), du code technique.<br>
On parle de code technique quand celui-ci ne porte pas directement de rÃ¨gle mÃ©tier, par exemple lâinterfaÃ§age avec le monde extÃ©rieur au travers dâune</p>
</div>
<div class="ulist">
<ul>
<li>
<p>API</p>
</li>
<li>
<p>Interface graphique</p>
</li>
<li>
<p>Connexion Ã  un broker de message</p>
</li>
<li>
<p>Connexion Ã  une base de donnÃ©es</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Il est possible de construire le <em>coeur</em> applicatif sans lâaide de framework ou autre bibliothÃ¨que afin de simplifier lâÃ©criture des tests et de rÃ©duire Ã  sa plus simple forme le code <em>mÃ©tier</em>.</p>
</div>
<div class="paragraph">
<p>On pourra venir par la suite y brancher des <em>connecteurs</em> qui feront le pont entre ce code et le reste du systÃ¨me ou les utilisateurs.</p>
</div>
<div class="paragraph">
<p>Une de ces approche est lâ<span class="underline">architecture hexagonale</span> que nous verrons en dÃ©tail un peu plus loin.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_a_lÃ©chelle_dun_ensemble_dapplication">2.3. A lâÃ©chelle dâun ensemble dâapplication</h3>
<div class="paragraph">
<p>Les considÃ©rations a cette Ã©chelle sont valables pour un SI (systÃ¨me dâinformation).</p>
</div>
<div class="paragraph">
<p>Dans un systÃ¨me dâinformation, il est courant que plusieurs applications, opÃ©rÃ©es par des Ã©quipes distinctes doivent Ã©changer des donnÃ©es.</p>
</div>
<div class="paragraph">
<p>Les choix dâarchitectures rÃ©alisÃ©s dans ce cadre doivent aussi bien prendre en compte les objectifs Ã©numÃ©rÃ©s en introduction (MaintenabilitÃ©, TestabilitÃ©, SÃ©curitÃ©, etc.) que les frictions entre les Ã©quipes.</p>
</div>
<div class="paragraph">
<p>Les Ã©quipes qui travaillent sur des applications diffÃ©rentes sont constituÃ©es dâhommes et de femmes qui ont des faÃ§ons de travailler diffÃ©rentes (agile, cycle en V, etc.), des rythmes diffÃ©rents (dÃ©calage horaire, temps partiel, etc.), des faÃ§ons dâopÃ©rer la production diffÃ©rentes (avec ou sans coupure de service, livraison continue, ou par lot, etc.).</p>
</div>
<div class="paragraph">
<p>Ces Ã©quipes nâont pas forcÃ©ment la mÃªme maturitÃ© technique non plus.</p>
</div>
<div class="paragraph">
<p>Il est important de prendre en compte ces Ã©lÃ©ments pour protÃ©ger le service rendu et fluidifier les Ã©changes entre Ã©quipes au maximum.</p>
</div>
<div class="sect3">
<h4 id="_exemple_1_communication_asynchrone">2.3.1. Exemple 1 : communication asynchrone</h4>
<div class="paragraph">
<p>ConsidÃ©rant une application soumise Ã  de forts traffics de maniÃ¨re irrÃ©guliÃ¨re, comme un site de simulation de crÃ©dit immobilier qui sera consultÃ© massivement entre 12 h et 14 h Ã  la pause dÃ©jeuner.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/mortgage_system_http.png" alt="mortgage system http">
</div>
</div>
<div class="paragraph">
<p>Le site public recueille les demandes de simulation et les envoie Ã  un service interne qui doit :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Se connecter rÃ©guliÃ¨rement Ã  des APIs externes de diffÃ©rentes banques pour maintenir des bases de calcul prÃ©cises</p>
</li>
<li>
<p>Faire ces calculs (imaginons-les lents pour lâintÃ©rÃªt de lâexercice) sur la base des informations donnÃ©es par les clients</p>
</li>
<li>
<p>Renvoyer la simulation au site public</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>MÃªme sâil y a peu de traffic, une interruption de service de quelques minutes peut Ãªtre dommageable, et faire perdre des clients ou de la visibilitÃ©.</p>
</div>
<div class="paragraph">
<p>Cependant si la communication entre le site public et le service interne est synchrone, une mise Ã  jour de ce dernier entraÃ®nerait <em>de facto</em> une coupure de service du site public ou une perte dâinformation.</p>
</div>
<div class="paragraph">
<p>Il peut Ãªtre intÃ©ressant dâÃ©tablir une communication asynchrone au travers dâun broker de message qui fera tampon entre les deux systÃ¨mes.<br>
Ainsi il nây aura ni coupure de service <em>visible</em> ni perte dâinformation.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/mortgage_system_amqp.png" alt="mortgage system amqp">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_exemple_2_lisser_la_charge">2.3.2. Exemple 2 : lisser la charge</h4>
<div class="paragraph">
<p>Dans la continuitÃ© du systÃ¨me dÃ©crit ci-dessus, considÃ©rant que le broker de message est couplÃ© Ã  lâapplicatif cÃ´tÃ© service pour des raisons historiques ou de maturitÃ© technologique (server applicatif + fournisseur dâAPI JMS par exemple).</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/mortgage_system_bad_bad_jms.png" alt="mortgage system bad bad jms">
</div>
</div>
<div class="paragraph">
<p>Envoyer beaucoup de message dâun coup (on parle de <em>coup de bÃ©lier</em>) Ã  un tel systÃ¨me pourrait diminuer ses performances voir provoquer son arrÃªt / crash.</p>
</div>
<div class="paragraph">
<p>Il peut Ãªtre dans ce cas plus simple que ce soit lâapplication cliente (celle qui envoie les messages) qui lisse la charge (on parle aussi de <em>throttling</em>), pour Ã©viter le couplage de pression entre les deux applications.</p>
</div>
<div class="paragraph">
<p>Mettre en place ce mÃ©canisme requiert de dÃ©finir une vitesse maximum (en message/sec par exemple) et de la respecter.<br>
Il existe plusieurs maniÃ¨res de construire un tel systÃ¨me, par exemple avec</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Un batch qui va lire Ã  interval rÃ©gulier les X plus vieux messages dans une base de donnÃ©e (attention cependant, un systÃ¨me de batch <em>scale</em> difficilement)</p>
</li>
<li>
<p>Une petite application dont lâÃ©tat nâest pas gÃ©rÃ© dans sa mÃ©moire (mais plutÃ´t dans une base de donnÃ©e, de faÃ§on Ã  pouvoir scaler si nÃ©cessaire)</p>
</li>
<li>
<p>Les fonctionnalitÃ©s de certains brokers</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quelques_types_darchitecture">3. Quelques types dâarchitecture</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Les organisations qui conÃ§oivent des systÃ¨mes (informatiques) tendent inÃ©vitablement Ã  produire des designs qui sont des copies de la structure de communication de leur organisation.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; attribuÃ©e Ã  Melvin Conway<br>
<cite>Loi de Conway</cite>
</div>
</div>
<div class="paragraph">
<p>Tout Ã  un coÃ»t, et le temps de dÃ©veloppement a souvent un coup plus Ã©levÃ© que le reste.</p>
</div>
<div class="paragraph">
<p>La direction que prend une architecture applicative doit permettre de faire correspondre le coÃ»t du dÃ©veloppement avec le gain espÃ©rÃ© et donc la stratÃ©gie de lâentreprise.</p>
</div>
<div class="paragraph">
<p>Au-delÃ  de lâaspect mercantile de la chose, il est Ã©galement plus <em>agrÃ©able</em> dâajouter de nouvelles fonctionnalitÃ©s, que de gÃ©rer une friction entre Ã©quipe ou de multiples bugs.</p>
</div>
<div class="paragraph">
<p>Lâarchitecture applicative doit donc tenir compte des cycles de dÃ©veloppement pour concentrer lâÃ©nergie sur la valeur ajoutÃ©e.</p>
</div>
<div class="sect2">
<h3 id="_n_tiers">3.1. N-tiers</h3>
<div class="paragraph">
<p>Lâarchitecture N-tiers est un dÃ©coupage en couches techniques dâune application.</p>
</div>
<div class="paragraph">
<p>Pour une application simple (API HTTP dâun cÃ´tÃ©, base de donnÃ©e de lâautre par exemple), on retrouve souvent <strong>3</strong> tiers :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>La couche des <span class="underline">contrÃ´leurs</span> dont la responsabilitÃ© est de</p>
<div class="ulist">
<ul>
<li>
<p>Communiquer en HTTP(S)</p>
</li>
<li>
<p>SÃ©curiser lâaccÃ¨s (Authentification et Authorisation)</p>
</li>
<li>
<p>SÃ©rialiser ou dÃ©sÃ©rialiser la donnÃ©e reprÃ©sentÃ©e par des objets <em>anÃ©miques</em> (DTO pour Data Transfer Object)</p>
</li>
<li>
<p>RÃ©aliser des contrÃ´les de surface notamment sur la structure des donnÃ©es envoyÃ©es et reÃ§ues</p>
</li>
</ul>
</div>
</li>
<li>
<p>La couche des <span class="underline">services</span> dont la responsabilitÃ© est de</p>
<div class="ulist">
<ul>
<li>
<p>Fournir aux contrÃ´leurs des traitements mÃ©tiers de haut niveau afin quâaucune logique mÃ©tier ne soit nÃ©cessaire en amont</p>
</li>
<li>
<p>Valider la cohÃ©rence des donnÃ©es et le respect des rÃ¨gles <em>mÃ©tiers</em></p>
</li>
<li>
<p>(GÃ©rer les transactions, si la base de donnÃ©e est transactionnelle)</p>
</li>
</ul>
</div>
</li>
<li>
<p>La couche de <span class="underline">persistence</span> (on parle aussi de <em>repositories</em>) dont la responsabilitÃ© est de</p>
<div class="ulist">
<ul>
<li>
<p>Communiquer avec une base de donnÃ©e</p>
</li>
<li>
<p>SÃ©rialiser ou dÃ©sÃ©rialiser la donnÃ©e reprÃ©sentÃ©e par des objets <em>anÃ©miques</em> (DTO pour Data Transfer Object)</p>
</li>
<li>
<p>InterprÃ©ter les erreurs techniques de la base de donnÃ©es pour Ãªtre gÃ©rÃ©es par un traitement mÃ©tier dans la couche service</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/n_tiers.png" alt="n tiers">
</div>
</div>
<div class="paragraph">
<p>Historiquement, cette architecture est appliquÃ©e telle-quelle Ã  lâensemble de la base de code dâun projet informatique et apporte de la confusion sur les diffÃ©rents domaines mÃ©tiers.</p>
</div>
<div class="paragraph">
<p>Il est plus intÃ©ressant dâintroduire un dÃ©coupage qui correspond aux diffÃ©rents domaines.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/n_tiers_tree_lvl1.png" alt="n tiers tree lvl1">
</div>
</div>
<div class="paragraph">
<p>Ainsi le fonctionnement de lâapplication est plus clair, et cela Ã©vite de mÃ©langer par inadvertance des composants entre les domaines.</p>
</div>
<div class="paragraph">
<p>Par ailleurs rien nâempÃªche de structurer le code dâun domaine en suivant ce dÃ©coupage technique.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/n_tiers_tree_lvl2.png" alt="n tiers tree lvl2">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hexagonale">3.2. Hexagonale</h3>
<div class="paragraph">
<p>Lâ<strong>architecture hexagonale</strong> vise Ã  sÃ©parer le code <em>mÃ©tier</em> du code <em>technique</em>.</p>
</div>
<div class="paragraph">
<p>Pour cela on distingue le coeur (<em>core</em>) de lâapplication, des <em>adaptateurs</em> (<em>adapters</em>) qui font le lien entre le code <em>mÃ©tier</em> et le reste du monde ; que ce soit via des communications <em>machine-to-machine</em> (HTTPS, MQTT, etc.) ou <em>human-to-machine</em> (interface graphique, email, SMS, etc.).</p>
</div>
<div class="paragraph">
<p>Les objectifs sont les suivants :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DÃ©coupler les problÃ©matiques techniques en dehors du code qui contient les rÃ¨gles mÃ©tiers</p>
</li>
<li>
<p>Simplifier les tests unitaires du code mÃ©tier, du fait de lâabsence de frameworks et bibliothÃ¨ques</p>
</li>
<li>
<p>Permettre (thÃ©oriquement) de remplacer un <em>adaptateur</em> sans modifier le reste de lâapplication. Dans la pratique, ce cas arrive assez peu et le cas Ã©chÃ©ant, le changement de paradigme qui y est souvent associÃ© (SQL &#8660; NOSQL, synchrone &#8660; asynchrone) nÃ©cessite de revoir lâarchitecture de lâapplication.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/hexagonal_architecture.png" alt="hexagonal architecture">
</div>
</div>
<div class="paragraph">
<p>On appelle :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>API</strong> (<strong>A</strong>pplication <strong>P</strong>rogramming <strong>I</strong>nterface) une interface qui est <span class="underline">implÃ©mentÃ©e par le code mÃ©tier</span>, et est appelÃ©e par un adaptateur</p>
</li>
<li>
<p><strong>SPI</strong> (<strong>S</strong>ervice <strong>P</strong>rovider <strong>I</strong>nterface) une interface qui est appelÃ©e par le code mÃ©tier, et est <span class="underline">implÃ©mentÃ©e par un adaptateur</span>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>On commence une application qui suit les principes de lâarchitecture hexagonale par le code dâun domaine mÃ©tier / fonctionnalitÃ©.</p>
</div>
<div class="paragraph">
<p>Ce code ne doit contenir aucune dÃ©pendance vers un framework ou une bibliothÃ¨que.</p>
</div>
<div class="paragraph">
<p>Ã cette fin, il est plus simple de lâisoler dans un module dÃ©diÃ© de sorte que ce code nâait en pratique aucune dÃ©pendance (<em>classpath</em> vide).</p>
</div>
<div class="paragraph">
<p>Par la suite dâautres modules peuvent Ãªtre ajoutÃ©s contenant le code des adaptateurs, ces modules auront une dÃ©pendance sur le module coeur.</p>
</div>
</div>
<div class="sect2">
<h3 id="_monolithique_vs_micro_services">3.3. Monolithique vs micro-services</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Iâll keep saying this&#8230;&#8203; if people canât build monoliths properly, microservices wonât help.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Simon Brown<br>
<cite>@simonbrown</cite>
</div>
</div>
<div class="paragraph">
<p>Lâapproche monolithique consiste Ã  former une seule application avec la totalitÃ© des fonctionnalitÃ©s.</p>
</div>
<div class="paragraph">
<p>Ce qui peut impliquer de <em>mÃ©langer</em> plusieurs domaines mÃ©tiers, en reprenant lâexemple dâun site de commerce Ã©lectronique : gestion du catalogue, dÃ©tail du panier, paiement, facturation, etc.</p>
</div>
<div class="paragraph">
<p>Il est nÃ©cessaire de structurer le code dâune application monolithique en <em>modules</em> pour isoler les parties du code qui nâont pas Ã  interagir entre elles.</p>
</div>
<div class="paragraph">
<p>Le risque dans le cas oÃ¹ une telle structure nâest pas mise en place est de voir la complexitÃ© de lâapplication augmenter de maniÃ¨re exponentielle Ã  chaque ajout de fonctionnalitÃ©.<br>
On parle dans ce cas de code <em>spaghetti</em>.<br>
La mÃ©taphore des <em>spaghettis</em> vient des morceaux de code entrelacÃ©s, mÃ©langÃ©s, ce qui les rend difficiles Ã  tester en isolation du fait des nombreuses interactions entre les domaines voir les couches (au sens N-tiers).</p>
</div>
<div class="paragraph">
<p>Lâapproche micro-service a ceci de diffÃ©rent que les diffÃ©rents domaines sont gÃ©rÃ©s par des applications diffÃ©rentes.</p>
</div>
<div class="paragraph">
<p>MÃªme sâil est toujours possible de partager du code au travers de bibliothÃ¨ques communes, il est nÃ©cessaire, comme dans un monolithe de ne pas mÃ©langer les domaines.<br>
Une des rÃ¨gles qui transcrit le mieux ce principe est le fait que les bases de donnÃ©es soient distinctes pour chaque micro-service.<br>
Cette rÃ¨gle permet Ã©galement dâÃ©viter un couplage au niveau du modÃ¨le de donnÃ©e.</p>
</div>
<div class="paragraph">
<p>De mÃªme, si des micro-services doivent communiquer entre eux, il est prÃ©fÃ©rable que ce soit de maniÃ¨re asynchrone (Ã  travers un broker de message par exemple).</p>
</div>
<div class="paragraph">
<p>Ainsi la coupure dâun service nâaffecte pas les autres.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/micro_services_ecommerce.png" alt="micro services ecommerce">
</div>
</div>
<div class="paragraph">
<p>Une architecture basÃ©e sur les microservices a des inconvÃ©nients :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Plusieurs applications diffÃ©rentes doivent Ãªtre dÃ©ployÃ©es frÃ©quemment</p>
<div class="ulist unstyled">
<ul class="unstyled">
<li>
<p>&#8594; La livraison et le dÃ©ploiement doivent Ãªtre robustes et automatisÃ©s</p>
</li>
</ul>
</div>
</li>
<li>
<p>Il est plus difficile dâinvestiguer un problÃ¨me, pouvant Ãªtre liÃ© Ã  une succession dâÃ©vÃ¨nements dans diffÃ©rentes applications</p>
<div class="ulist unstyled">
<ul class="unstyled">
<li>
<p>&#8594; Les logs doivent Ãªtre uniques, informatives et centralisÃ©es</p>
</li>
<li>
<p>&#8594; Une solution de traÃ§age des appels doit Ãªtre mise en place (correlation-id, header via, APM, etc.)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Le coÃ»t en infrastructure est plus Ã©levÃ©, car il y a plus dâapplications actives et dâorganes techniques pour les interconnexions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Et a des avantages :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Le code dâun micro-service est plus petit, plus simple</p>
</li>
<li>
<p>Les micro-services peuvent Ã©voluer indÃ©pendamment les uns des autres, et Ãªtre dÃ©veloppÃ©s par des Ã©quipes diffÃ©rentes dans des <em>repositories</em> diffÃ©rents</p>
</li>
<li>
<p>Les micro-services peuvent Ãªtre dimensionnÃ©s indÃ©pendamment</p>
<div class="ulist unstyled">
<ul class="unstyled">
<li>
<p>&#8594; Si le domaine <em>produit</em> de notre site de commerce Ã©lectronique est plus sollicitÃ© que le domaine <em>paiement</em>, il sera possible dâaffecter plus ressources Ã  celui-ci sans en dÃ©penser inutilement pour les services faiblement sollicitÃ©s</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dimensionnement_considÃ©rations_relatives">4. Dimensionnement &amp; considÃ©rations relatives</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Historiquement, la construction dâapplication monolithique et dont lâÃ©tat est gÃ©rÃ© en mÃ©moire (<em>stateful</em>) nÃ©cessitait avec lâaugmentation de la charge des serveurs plus puissants.</p>
</div>
<div class="paragraph">
<p>Il sâagissait donc dâaugmenter</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RAM (mÃ©moire)</p>
</li>
<li>
<p>FrÃ©quence CPU</p>
</li>
<li>
<p>Nombre de coeur CPU</p>
</li>
<li>
<p>Taille du disque dur</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dans ce cas, on parle de <strong>dimensionnement vertical</strong>.<br>
Il se trouve que le coÃ»t du matÃ©riel nâest pas proportionnel Ã  la puissance, mais plutÃ´t exponentiel.<br>
Ce type de dimensionnement (ou <em>scaling</em>) arrive donc rapidement Ã  une limite technique (puissance maximale des CPUs Ã  une Ã©poque, etc.) ou financiÃ¨re.</p>
</div>
<div class="paragraph">
<p>Certains systÃ¨mes, comme les bases de donnÃ©es SQL traditionnelles (Oracle, PostgreSQL, MariaDB, etc.) ne peuvent augmenter leurs capacitÃ©s que de cette maniÃ¨re.</p>
</div>
<div class="paragraph">
<p>Ã lâinverse, les applications peuvent Ãªtre structurÃ©es de maniÃ¨re Ã  pouvoir Ãªtre dimensionnÃ©es diffÃ©remment.</p>
</div>
<div class="paragraph">
<p>On parle dans ce cas de <strong>dimensionnement horizontal</strong>, qui consiste Ã  augmenter le nombre de conteneurs / vms / serveurs pour augmenter de maniÃ¨re linÃ©aire le nombre dâappels que le systÃ¨me peut traiter.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/vertical_vs_horizontal_scaling.png" alt="vertical vs horizontal scaling">
</div>
</div>
<div class="paragraph">
<p>Un autre aspect nÃ©gatif de lâapproche instance unique est que tout changement nÃ©cessitant un redÃ©marrage de lâapplication (configuration, nouvelle version, etc.) interrompt le service rendu.</p>
</div>
<div class="paragraph">
<p>Dans le cas oÃ¹ il y a plusieurs instances dâune mÃªme application, que ce soit derriÃ¨re un <strong>rÃ©partiteur de charge</strong> (<em>load-balancer</em>) ou quâelles consomment les messages dâun broker, en Ã©teindre une ne coupe pas le service.</p>
</div>
<div class="paragraph">
<p>Il est tout Ã  fait possible de configurer le <strong>rÃ©partiteur de charge</strong> afin de ne plus distribuer de connexion vers une instance, de laisser les connexions existantes se terminer et enfin de pouvoir Ã©teindre lâinstance sans impact pour les utilisateurs.</p>
</div>
<div class="paragraph">
<p>Traiter toutes les instances dâune mÃªme application comme celÃ  pour rÃ©aliser une mise Ã  jour est appelÃ© <strong>rolling update</strong>.</p>
</div>
<div class="paragraph">
<p>Attention toutefois Ã  ce que les systÃ¨mes connectÃ©s Ã  lâapplication (clients dâune API, base de donnÃ©es, etc.) puissent fonctionner avec les deux versions qui vont cohabiter durant la mise Ã  jour.</p>
</div>
<div class="sect2">
<h3 id="_identifier_les_spofs">4.1. Identifier les SPOFs</h3>
<div class="paragraph">
<p>Les SPOFs (<strong>S</strong>ingle <strong>P</strong>oint <strong>O</strong>f <strong>F</strong>ailure) sont les parties dâun systÃ¨me qui ne peuvent pas avoir plus dâune instance et qui par consÃ©quent entrainent une coupure de service en cas dâarrÃªt (crash, mise Ã  jour, etc.).</p>
</div>
<div class="paragraph">
<p>Il est important de les identifier et de monitorer leur Ã©tat pour pouvoir rÃ©agir en cas de problÃ¨me.</p>
</div>
<div class="paragraph">
<p>Cette rÃ©action peut Ãªtre automatique (bascule sur un rÃ©plica jusque-lÃ  passif) ou manuelle (dÃ©marrage de services alternatifs).</p>
</div>
<div class="paragraph">
<p>Tenir compte des SPOFs peut Ã©galement influer sur lâarchitecture du systÃ¨me pour limiter au strict minimum la charge qui y est envoyÃ©e, ou mettre en place des mÃ©canismes pour allÃ©ger cette charge (un cache de donnÃ©es par exemple).</p>
</div>
<div class="paragraph">
<p>Ces considÃ©rations sont applicables Ã  tout systÃ¨me dont on voudrait diminuer lâusage (une API extÃ©rieure payante par exemple) et rejoigne de mÃªme concept de dÃ©couplage (diminuer les dÃ©pendances entres composants).</p>
</div>
<div class="paragraph">
<p>Les bases de donnÃ©es (SQL) sont Ã©galement souvent des SPOFs ; il est cependant possible dans la plupart des cas de mettre en place des rÃ©plicas pouvant remplacer la base principale en cas dâindisponibilitÃ©.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/pg_auto_failover.png" alt="pg auto failover">
</div>
<div class="title">Figure 2. MÃ©canisme de bascule pour PostgreSQL (<code>pg_auto_failover</code>)</div>
</div>
</div>
<div class="sect2">
<h3 id="_identifier_les_points_de_contention">4.2. Identifier les points de contention</h3>
<div class="paragraph">
<p>Quand un systÃ¨me est soumis Ã  de fortes charges, des points de contention (ou goulot dâÃ©tranglement) peuvent apparaÃ®tre.</p>
</div>
<div class="paragraph">
<p>Il sâagit de partie de systÃ¨me dont la vitesse de traitement est plus lente et qui constitue la vitesse maximale du systÃ¨me dans son ensemble.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Ã lâinstar dâun systÃ¨me dâÃ©coulement dâeaux pluviales, si un des tuyaux a un faible dÃ©bit, câest tout le systÃ¨me qui est plus lent, et qui risque lâengorgement
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ces points de contention peuvent provoquer des rÃ©actions en chaÃ®ne ou en cacher dâautres.</p>
</div>
<div class="paragraph">
<p>Pour les identifier et si nÃ©cessaire les amÃ©liorer, il est nÃ©cessaire dâavoir une supervision prÃ©cise des diffÃ©rents composants du systÃ¨me.<br>
La supervision est constituÃ©e entre autres, dâun ensemble de sondes qui permettent de relever des donnÃ©es Ã  interval rÃ©gulier et dâen faire des courbes.<br>
Ces courbes tÃ©moignent de lâÃ©volution du systÃ¨me dans le temps et permettent de faire la corrÃ©lation entre des Ã©vÃ¨nements exogÃ¨nes et des consÃ©quences endogÃ¨nes, notamment lâapparition de points de contention.</p>
</div>
</div>
<div class="sect2">
<h3 id="_rÃ©partir_la_charge">4.3. RÃ©partir la charge</h3>
<div class="sect3">
<h4 id="_pour_les_communications_synchrones">4.3.1. Pour les communications synchrones</h4>
<div class="paragraph">
<p>Pour distribuer la charge sur plusieurs instances dâun mÃªme service, on utilise des rÃ©partiteurs de charge quâils soient matÃ©riel (F5, AltÃ©on, etc.) ou logiciel (HAProxy, Nginx, Traefik, etc.).</p>
</div>
<div class="paragraph">
<p>Il existe diffÃ©rentes configurations possibles, notamment pour affecter des poids aux nÅuds cibles ou Ã©tablir une affinitÃ© de session (<em>sticky session</em>).</p>
</div>
<div class="paragraph">
<p>Les rÃ©partiteurs de charge logiciels sont plus simples Ã  configurer et peuvent mÃªme Ãªtre pilotÃ©s par une API.<br>
Cela permet notamment dâautomatiser des opÃ©rations telles que le <strong>rolling update</strong> prÃ©cÃ©demment mentionnÃ©.</p>
</div>
</div>
<div class="sect3">
<h4 id="_pour_les_communications_asynchrones">4.3.2. Pour les communications asynchrones</h4>
<div class="paragraph">
<p>Pour ce qui est des communications asynchrones, on va tendre le plus possible vers lâutilisation dâun <em>broker de message</em> qui fera le tampon entre les applications communicantes.</p>
</div>
<div class="paragraph">
<p>Un certain nombre dâoutils peuvent Ãªtre mis en place pour rendre un broker <em>hautement disponible</em> (<strong>H</strong>igh <strong>A</strong>vailability) et capable dâingÃ©rer de grosses volumÃ©tries.</p>
</div>
<div class="paragraph">
<p>Ce faisant, le broker pourra accueillir les Ã©ventuels coups de bÃ©liers (trÃ¨s grosses charges temporaires) sans redistribuer la pression aux applications clientes.</p>
</div>
<div class="paragraph">
<p>En effet, quand deux systÃ¨mes communiquent, il est prÃ©fÃ©rable de fonctionner en <em>flux tirÃ©</em> de sorte que lâapplication cliente consomme quand elle le veut et au rythme ou elle le peut les messages qui lui sont destinÃ©s.</p>
</div>
<div class="paragraph">
<p>La rÃ©partition de charge se fait naturellement avec lâaugmentation du nombre dâinstances de lâapplication cliente (pour Kafka, au sein dâun mÃªme <strong>client-group</strong>, le nombre de partitions doit Ãªtre supÃ©rieure Ã  celui des applications clientes).</p>
</div>
<div class="paragraph">
<p>Il faut cependant Ãªtre vigilant Ã  la stratÃ©gie de livraison de message :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>at most once</strong> : un message est dÃ©livrÃ© au plus une fois. Par consÃ©quent, il peut y avoir des pertes de message (cas marginal).</p>
<div class="ulist">
<ul>
<li>
<p>Cas dâusage : notifications, donnÃ©es peu importantes</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>at least once</strong> : un message est dÃ©livrÃ© au moins une fois. Par consÃ©quent, il peut Ãªtre dÃ©livrÃ© plusieurs fois (cas marginal) et lâapplication cliente doit Ãªtre capable de dÃ©-dupliquer ces messages</p>
<div class="ulist">
<ul>
<li>
<p>Cas dâusage : tout le reste, du moment quâon ne peut pas se permettre de perdre un message (commande client, transaction bancaire, changement dâune fiche patient, etc.)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exemple_dÃ©volution_darchitecture">4.4. Exemple dâÃ©volution dâarchitecture</h3>
<div class="paragraph">
<p>ConsidÃ©rant une application <em>classique</em> comme celle-ci :</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/korekto_context.png" alt="korekto context">
</div>
<div class="title">Figure 3. Diagramme de Contexte</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/korekto_container_v0.png" alt="korekto container v0">
</div>
<div class="title">Figure 4. Diagramme de Container</div>
</div>
<div class="sect3">
<h4 id="_introduction_dun_rÃ©partiteur_de_charge">4.4.1. Introduction dâun rÃ©partiteur de charge</h4>
<div class="paragraph">
<p>Le dimensionnement horizontal, câest la capacitÃ© du systÃ¨me Ã  rÃ©partir la charge sur plusieurs instances (ou nÅuds).<br>
Mais du point de vue des utilisateurs, il nây a quâun seul service (<a href="https://korekto.io" class="bare">https://korekto.io</a> par exemple).<br>
Pour faire cela il est nÃ©cessaire dâintroduire un rÃ©partiteur de charge.</p>
</div>
<div class="paragraph">
<p>Attention ici, la partie qui exÃ©cute une tÃ¢che toutes les 4 heures ne doit Ãªtre active que sur une seule instance, sous peine de faire le mÃªme travail plusieurs fois, ce qui peut provoquer :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Charge CPU inutile</p>
</li>
<li>
<p>Ãtats incohÃ©rents en base</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/korekto_container_v1.png" alt="korekto container v1">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dÃ©coupage_de_lapplicatif">4.4.2. DÃ©coupage de lâapplicatif</h4>
<div class="paragraph">
<p>Certaines fonctions de lâapplication, sont exÃ©cutÃ©es plus au moins souvent, et utilisent plus ou moins de CPU.</p>
</div>
<div class="paragraph">
<p>Il peut Ãªtre intÃ©ressant de dÃ©couper une application monolithique en plusieurs petites applications pour pouvoir dimensionner finement les fonctions les plus sollicitÃ©es.</p>
</div>
<div class="paragraph">
<p>Ce dÃ©coupage doit respecter une unique rÃ¨gle pour Ãªtre profitable :</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Les applications dÃ©coupÃ©es Ã  partir dâun monolithe doivent Ãªtre indÃ©pendantes dâun point de vue mÃ©tier et technique.</p>
</div>
<div class="paragraph">
<p>Câest-Ã -dire que si une de ces applications est amenÃ©e Ã  Ã©voluer, elle doit pouvoir Ãªtre mise Ã  jour sans impact dans les autres applications</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/korekto_container_v2.png" alt="korekto container v2">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_suppression_des_spofs">4.4.3. Suppression des SPOFs</h4>
<div class="paragraph">
<p>Les points de dÃ©faillance unique (<strong>S</strong>ingle <strong>P</strong>oint <strong>O</strong>f <strong>F</strong>ailure), sont des conteneurs du systÃ¨me qui ne peuvent pas Ãªtre rÃ©pliquÃ©s.<br>
Cela pose 2 problÃ¨mes :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Si le conteneur ne fonctionne plus, il y a une coupure de service</p>
</li>
<li>
<p>Si le trafic augmente (ici le nombre dâexercices Ã  corriger), la seule solution est par dÃ©finition le dimensionnement vertical.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La cause des SPOFs est souvent un Ã©tat en mÃ©moire qui ne peut Ãªtre facilement rÃ©pliquÃ©.<br>
Câest le cas de notre conteneur <strong>[batch]</strong>.</p>
</div>
<div class="paragraph">
<p>En effet, si plusieurs instances devaient sâexÃ©cuter, comment pourraient-elles simplement se synchroniser pour se rÃ©partir le travail et reprendre celui des autres instances dans le cas de pannes ?</p>
</div>
<div class="paragraph">
<p>Dans notre cas, il est possible de faire plus simple en utilisant les hooks de GitHub pour Ãªtre notifiÃ© en cas de changement, plutÃ´t que de lancer une tache quoi quâil arrive.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/korekto_container_v3.png" alt="korekto container v3">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ne_pas_communiquer_par_le_stockage">4.4.4. Ne pas communiquer par le stockage !</h4>
<div class="paragraph">
<p>Quand nous avons dÃ©coupÃ© notre applicatif, nous avons commis une grave erreur.<br>
En effet, le conteneur <strong>[web]</strong> et le conteneur <strong>[grader]</strong> communiquent par la base de donnÃ©es.</p>
</div>
<div class="paragraph">
<p>Câest un <strong>anti-pattern</strong> dâarchitecture, car :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Comment changer la base par une autre sans impacter les 2 conteneurs ?</p>
</li>
<li>
<p>Comment changer la faÃ§on de stocker la donnÃ©e sans impacter les 2 conteneurs ?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Bref, ces 2 conteneurs sont couplÃ©s.</p>
</div>
<div class="paragraph">
<p>Le but ici va Ãªtre dâintroduire un nouveau <em>container</em> qui va abstraire le stockage.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/korekto_container_v4.png" alt="korekto container v4">
</div>
</div>
<div class="paragraph">
<p>Ainsi, dans le cas oÃ¹</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Une partie de la donnÃ©e doit Ãªtre stockÃ©e de maniÃ¨re diffÃ©rente (dans une base de donnÃ©e relationnelle par ex)</p>
<div class="ulist unstyled">
<ul class="unstyled">
<li>
<p>&#8594; la seule modification Ã  apporter est dans le code du conteneur <strong>[storage API]</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Le format de spÃ©cification dâexercice Ã©volue pour inclure plus de donnÃ©es -&#8594; [storage API] on propose une nouvelle API (GET / POST / PUT / DELETE) <a href="#">/api/admin/specification/exercise/${name}/v2</a></p>
<div class="ulist unstyled">
<ul class="unstyled">
<li>
<p>&#8594; <strong>[web]</strong> on utilise cette nouvelle API pour que les professeurs puissent Ã©crire des spÃ©cifications plus dÃ©taillÃ©es</p>
</li>
<li>
<p>&#8594; <strong>[grader]</strong> on utilise cette nouvelle API pour corriger les exercices plus finement</p>
</li>
<li>
<p>&#8594; <strong>[storage API]</strong> on supprime lâancienne API (<a href="#">/api/admin/specification/exercise/${name}/v1</a>) maintenant que plus aucun conteneur ne lâutilise</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ce genre de changement peut Ãªtre apportÃ© sans coupure de service.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_documenter_larchitecture">5. Documenter lâarchitecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Historiquement, la documentation dâun projet informatique Ã©tait trÃ¨s verbeuse (Cahier des charges techniques, <strong>D</strong>ossier dâ<strong>A</strong>rchitecture <strong>T</strong>ransverse, etc.).</p>
</div>
<div class="paragraph">
<p>Or, un projet informatique Ã©volue vite, plus vite que ces documents.<br>
Cette "documentation" devient alors obsolÃ¨te et amÃ¨ne des incomprÃ©hensions ou des bugs car certaines informations deviennent fausses avec le temps.</p>
</div>
<div class="paragraph">
<p>Documenter un projet est cependant nÃ©cessaire pour transmettre la connaissance entre les diffÃ©rents individus qui vont sây succÃ©der.</p>
</div>
<div class="paragraph">
<p>Lâobjectif est donc dâÃ©crire le minimum vital de documentation en Ã©liminant le superflu et de raccrocher le plus possible cette documentation au code.</p>
</div>
<div class="paragraph">
<p>On parle alors de documentation vivante, si celle-ci Ã©volue comme le code, et notamment si des parties sont gÃ©nÃ©rÃ©es Ã  partir du code.</p>
</div>
<div class="sect2">
<h3 id="_readme">5.1. README</h3>
<div class="paragraph">
<p>Le fichier README, Ã©crit en Markdown ou en AsciiDoc (comme ce cours) se trouve Ã  la racine du projet / dÃ©pÃ´t.<br>
Il sâagit de la porte dâentrÃ©e pour un projet inconnu.</p>
</div>
<div class="paragraph">
<p>Il renseigne sur les questions suivantes :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ã quoi sert le projet ?</p>
</li>
<li>
<p>Comment utiliser le projet (outil de construction, etc.)</p>
</li>
<li>
<p>Comment contacter et travailler avec les autres personnes sur ce projet</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>TrÃ¨s populaire dans le monde de lâopen-source cette pratique et Ã©galement importante en entreprise dÃ¨s lors que de nombreux projets cohabitent dans un mÃªme systÃ¨me dâinformation et que diffÃ©rentes Ã©quipes doivent travailler ensembles.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/readme_sample.png" alt="readme sample">
</div>
<div class="title">Figure 5. Fichier README du projet Spring</div>
</div>
</div>
<div class="sect2">
<h3 id="_c4">5.2. C4</h3>
<div class="paragraph">
<p><strong>C4</strong> est une approche pour concevoir un systÃ¨me informatique sans en compliquer inutilement lâarchitecture.</p>
</div>
<div class="paragraph">
<p>Pour ce faire, il est nÃ©cessaire dâÃ©tablir un ensemble de termes et dâabstractions avec lesquels tous les intervenants du projet pourront se <strong><em>comprendre</em></strong>.</p>
</div>
<div class="paragraph">
<p>Câest une Ã©tape cruciale, qui permet dâÃ©viter par la suite dâavoir des incomprÃ©hensions entre les diffÃ©rents corps de mÃ©tier (fonctionnels, dÃ©veloppeurs, intÃ©grateurs, etc.).</p>
</div>
<div class="paragraph">
<p>Ce sont ces Ã©lÃ©ments qui permettront de construire les diagrammes qui seront Ã  la base du projet.</p>
</div>
<div class="sect3">
<h4 id="_contexte">5.2.1. Contexte</h4>
<div class="paragraph">
<p>Avec cette base, les intervenants peuvent construire le <strong>diagramme de <em>contexte</em></strong>.</p>
</div>
<div class="paragraph">
<p>Ce diagramme permet de comprendre les principales fonctionnalitÃ©s du systÃ¨me <span class="underline">sans</span> afficher <strong>comment</strong> le systÃ¨me est organisÃ©.</p>
</div>
<div class="paragraph">
<p>Le systÃ¨me est reprÃ©sentÃ© par une unique forme (boite noire) qui sera en interaction avec des personnes ou dâautres systÃ¨mes.</p>
</div>
<div class="paragraph">
<p>Les dÃ©tails (technologies, protocoles, etc.) nâont pas dâimportance dans ce diagramme, qui doit pouvoir Ãªtre compris par des intervenants non-techniques.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/c4_context_diagram.png" alt="c4 context diagram">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_container">5.2.2. Container</h4>
<div class="paragraph">
<p>Une fois les fonctionnalitÃ©s du systÃ¨mes acquises, on peut <em>zoome</em>} dâun cran avec le <strong>diagramme de <em>conteneurs</em></strong>.</p>
</div>
<div class="paragraph">
<p>On entend par <em>conteneur</em> tout systÃ¨me qui peut hÃ©berger du code ou des donnÃ©es (application, base de donnÃ©es, broker, etc.).</p>
</div>
<div class="paragraph">
<p>Ce diagramme va reflÃ©ter lâarchitecture du systÃ¨me et permettre de visualiser comment les <span class="underline">responsabilitÃ©s</span> sont rÃ©parties entre les diffÃ©rentes briques logicielles.</p>
</div>
<div class="paragraph">
<p>Ici peuvent Ãªtre reprÃ©sentÃ©s</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>SÃ©curitÃ©</strong> : zones rÃ©seau, flux chiffrÃ©s, traÃ§abilitÃ©, etc.</p>
</li>
<li>
<p><strong>ScalabilitÃ©</strong> : load-balancers, (SPOF), etc.</p>
</li>
<li>
<p><strong>FiabilitÃ©</strong> : sauvegarde, rÃ©plication, etc</p>
</li>
<li>
<p><strong>Supervision</strong> : sondes, bases, IHM, etc.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/c4_container_diagram.png" alt="c4 container diagram">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_composant">5.2.3. Composant</h4>
<div class="paragraph">
<p>On peut Ã  nouveau <em>zoomer</em> sur chacun des conteneurs grÃ¢ce au <strong>diagramme de <em>composants</em></strong>.</p>
</div>
<div class="paragraph">
<p>Ce diagramme dÃ©taille ce dont est composÃ© un conteneur, avec un dÃ©coupage possible par</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FonctionnalitÃ© transverse</p>
</li>
<li>
<p>Service mÃ©tier</p>
</li>
<li>
<p>Workflow</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Un composant a donc une identitÃ© logique, une <span class="underline">responsabilitÃ©</span> et interagit avec dâautres composants.</p>
</div>
<div class="paragraph">
<p>Sont habituellement consignÃ©s les dÃ©tails dâimplÃ©mentation et choix technologiques car ce schÃ©ma peut Ãªtre la documentation la plus dÃ©taillÃ©e dâun projet.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/c4_component_diagram.png" alt="c4 component diagram">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_classe">5.2.4. Classe</h4>
<div class="paragraph">
<p>Si nÃ©cessaire, il est possible de descendre au classique <strong>diagramme UML de <em>classes</em></strong>.</p>
</div>
<div class="paragraph">
<p>Ce diagramme est rarement utile si les besoins sont clairs, et les responsabilitÃ©s bien rÃ©parties.</p>
</div>
<div class="paragraph">
<p>Cependant, pour modÃ©liser un comportement complexe, ce schÃ©ma peut mettre en lumiÃ¨re une interaction complexe entre plusieurs objets.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/c4_class_diagram.jpg" alt="c4 class diagram">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adr_architectural_decision_records">5.3. ADR (Architectural Decision Records)</h3>
<div class="paragraph">
<p>Lâ<strong>ADR</strong> est un journal dont chaque entrÃ©e concerne un choix structurant dans lâarchitecture dâune application.</p>
</div>
<div class="paragraph">
<p>Il est Ã©crit par les dÃ©veloppeurs et stockÃ© le plus souvent Ã  cÃ´tÃ© du code, dans le mÃªme dÃ©pÃ´t.</p>
</div>
<div class="paragraph">
<p>La lecture de ce journal permet de comprendre pourquoi et comment une application est construite.</p>
</div>
<div class="paragraph">
<p>En effet dans une entrÃ©e du journal, on va retrouver</p>
</div>
<div class="ulist">
<ul>
<li>
<p>La date</p>
</li>
<li>
<p>Les individus impliquÃ©s</p>
</li>
<li>
<p>Le contexte : ce qui a amenÃ© Ã  faire ce choix (problÃ¨me de sÃ©curitÃ©, dâorganisation, de performance, etc.)</p>
</li>
<li>
<p>Les diffÃ©rentes solutions envisagÃ©es</p>
</li>
<li>
<p>La dÃ©cision</p>
</li>
<li>
<p>Les consÃ©quences prÃ©vues</p>
</li>
<li>
<p>Ãventuellement un statut, qui tÃ©moigne que la question a Ã©tÃ© posÃ©e, rÃ©flÃ©chie, mais que finalement aucune solution nâa Ã©tÃ© retenue</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_documentation_des_apis">5.4. Documentation des APIs</h3>
<div class="paragraph">
<p>Les APIs exposÃ©es Ã  lâextÃ©rieur dâun systÃ¨me peuvent Ãªtre documentÃ©es de diffÃ©rentes maniÃ¨res :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Contract First</strong> : on Ã©crit le contrat dans un format donnÃ© (RAML, WSDL, etc.), et ensuite on Ã©crit ou on <em>gÃ©nÃ¨re</em> le code correspondant.<br>
Ã noter que si le code est gÃ©nÃ©rÃ©, il y a toujours une seconde Ã©tape de "raccordement" au code mÃ©tier.</p>
</li>
<li>
<p><strong>Code First</strong> : on Ã©crit le code technique permettant dâexposer lâAPI.<br>
Ce code peut Ãªtre enrichi de mÃ©tadonnÃ©es sur lâutilisation de lâAPI (description, signification des diffÃ©rents codes dâerreur, etc.).<br>
La documentation est ensuite gÃ©nÃ©rÃ©e sur la base de ce code, notamment avec lâinitiative <strong>OpenAPI</strong> et les nombreux outils de son Ã©cosystÃ¨me.<br>
Dans le cas ou ce mÃ©canisme est inclus dans la construction du projet, la documentation Ã©volue Ã  chaque changement de code.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Lâapproche <strong>code first</strong> est la plus pÃ©renne, car elle Ã©vite quâun dÃ©calage entre la documentation et le code sâintroduise au fil du temps.</p>
</div>
<div class="paragraph">
<p>Il faut cependant Ãªtre vigilant sur les modifications dâune API et Ã  ce que cela va impliquer pour les clients de cette API.</p>
</div>
<div class="paragraph">
<p>Certains changements sont sans consÃ©quences</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ajouter un champ dans une rÃ©ponse</p>
</li>
<li>
<p>Supprimer un champ optionnel dans une requÃªte</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>&#8594; <em>Qui peut le plus, peut le moins</em>.</p>
</div>
<div class="paragraph">
<p>Dâautres, comme</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Supprimer un champ dans une rÃ©ponse</p>
</li>
<li>
<p>Ajouter un champ obligatoire dans une requÃªte</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Vont entrainer des malfonctions dans la communication, et nÃ©cessitent dâÃªtre abordÃ©s diffÃ©remment.</p>
</div>
<div class="paragraph">
<p>Dans le cas oÃ¹ ce second genre de modifications est nÃ©cessaire, il est possible de proposer une nouvelle version de lâAPI tout en continuant de servir la premiÃ¨re version.</p>
</div>
<div class="paragraph">
<p>Ainsi les clients ont le temps de faire le changement de code nÃ©cessaire de leur cÃ´tÃ© pour utiliser la nouvelle version.<br>
Quand tous les clients ont opÃ©rÃ© ces changements, le code de la premiÃ¨re version peut Ãªre supprimÃ©.</p>
</div>
<div class="paragraph">
<p>Ce faisant, on introduit Ã  nouveau un <strong><em>dÃ©couplage</em></strong> entre les systÃ¨mes en permettant que chacun fasse les changements Ã  son rythme.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bdd_et_atdd">5.5. BDD et ATDD</h3>
<div class="paragraph">
<p>Le <strong>B</strong>ehavior <strong>D</strong>riven <strong>D</strong>evelopment et lâ<strong>A</strong>cceptance <strong>T</strong>est <strong>D</strong>riven <strong>D</strong>evelopment sont deux techniques similaires qui visent Ã  dÃ©crire le comportement des fonctionnalitÃ©s dâun systÃ¨me dans un formalisme comprÃ©hensible par tous les intervenants du projet.<br>
Il peut sâagir de langage naturel (FranÃ§ais, Anglais, etc.) ou de graphes dâÃ©tat, du moment que le vocabulaire est univoque.</p>
</div>
<div class="paragraph">
<p>Ce vocabulaire dont les mots et phrases vont Ãªtre utilisÃ©s dans diffÃ©rents tests et scÃ©narios est ensuite associÃ© Ã  du code.</p>
</div>
<div class="paragraph">
<p>Ces tests et scÃ©narios <em>compris par tous</em> deviennent alors <span class="underline"><strong><em>executables</em></strong></span>.</p>
</div>
<div class="paragraph">
<p>Ã lâinstar du TDD, il sâagit moins dâÃ©crire des tests que dâune mÃ©thodologie de travail.</p>
</div>
<div class="paragraph">
<p>Par ailleurs cette faÃ§on de construire les tests et scÃ©narios favorise la composition et donne aux intervenants plus dâautonomie ainsi quâune meilleure comprÃ©hension.</p>
</div>
<div class="paragraph">
<p>On trouve dans le BDD des contraintes sur le formalisme des scÃ©narios, contraintes similaires Ã  celle dâun <em>test unitaire</em> : les phrases doivent commencer par</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Given</strong> : les conditions initiales, il peut y en avoir zÃ©ro ou plus &#8594; <strong>[0..*]</strong></p>
</li>
<li>
<p><strong>When</strong> : l&#8217;Ã©lÃ©ment dÃ©clencheur, il doit y en avoir un et uniquement un &#8594; <strong>[1]</strong></p>
</li>
<li>
<p><strong>Then</strong> : les vÃ©rifications, il doit y en avoir au moins une &#8594; <strong>[1..*]</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 7. Description d&#8217;une fonctionnalitÃ© au format <strong>Gherkin</strong></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Is it Friday yet?
Everybody wants to know when it's Friday

  <span class="kn">Scenario</span><span class="p">:</span> Sunday isn't Friday
    <span class="nf">Given </span>today is Sunday
    <span class="nf">When </span>I ask whether it's Friday yet
    <span class="nf">Then </span>I should be told <span class="s">"Nope"</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 8. Association des phrases Ã  du code</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Stepdefs</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">today</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">actualAnswer</span><span class="o">;</span>

    <span class="nd">@Given</span><span class="o">(</span><span class="s">"today is Sunday"</span><span class="o">)</span> // <b class="conum">(1)</b>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">today_is_Sunday</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">today</span> <span class="o">=</span> <span class="s">"Sunday"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@When</span><span class="o">(</span><span class="s">"I ask whether it's Friday yet"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">i_ask_whether_it_s_Friday_yet</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">actualAnswer</span> <span class="o">=</span> <span class="nc">IsItFriday</span><span class="o">.</span><span class="na">isItFriday</span><span class="o">(</span><span class="n">today</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Then</span><span class="o">(</span><span class="s">"I should be told {string}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">i_should_be_told</span><span class="o">(</span><span class="nc">String</span> <span class="n">expectedAnswer</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="n">expectedAnswer</span><span class="o">,</span> <span class="n">actualAnswer</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Annotation fournie par le framework de test <strong>Cucumber</strong></p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_techniques_bonnes_pratiques">6. Techniques &amp; bonnes pratiques</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_kiss_yagni_dry">6.1. KISS, YAGNI &amp; DRY</h3>
<div class="paragraph">
<p>Quelques principes populaires qui circulent dans les communautÃ©s de dÃ©veloppeurs :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>K</strong>eep <strong>I</strong>t <strong>S</strong>tupid <strong>S</strong>imple : Le plus simple, le mieux.<br>
Faire simple nâest cependant pas toujours facile.</p>
</li>
<li>
<p><strong>Y</strong>ou <strong>A</strong>inât <strong>G</strong>onna <strong>N</strong>eed <strong>I</strong>t : Nâajouter que du code utile dans le prÃ©sent.<br>
Les prÃ©dictions sur le futur peuvent se rÃ©vÃ©ler fausses et la conception qui a Ã©tÃ© faites "en prÃ©vision de" peut faire obstacle une fois le futur devenu prÃ©sent.</p>
</li>
<li>
<p><strong>D</strong>onât <strong>R</strong>epeat <strong>Y</strong>ourself : La duplication est mal vue parmi les dÃ©veloppeurs, et amÃ¨ne plusieurs problÃ¨mes :</p>
<div class="ulist">
<ul>
<li>
<p>Câest plus de travail, il faut Ã©crire, tester et maintenir plusieurs fois le mÃªme code</p>
</li>
<li>
<p>En cas de bug, il faut corriger Ã  de multiples endroits, certains pouvant Ãªtre oubliÃ©s</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Câest cette mÃªme simplicitÃ© que lâon retrouve dans deux des douze principes du <strong>Manifeste Agile</strong> :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Our highest priority is to satisfy the customer through early and continuous delivery of <span class="underline"><strong>valuable</strong></span> software</p>
</li>
<li>
<p>Simplicity [the art of maximizing the amount of work not done] is essential.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_logs">6.2. Logs</h3>
<div class="listingblock">
<div class="title">Listing 9. Exemple de log peu utile</div>
<div class="content">
<pre class="rouge highlight"><code>2017-02-04 22:33:12 [thread-1] com.github.some.project.DatabaseService l.74 #################
2017-02-04 22:33:12 [thread-2] com.github.some.project.DatabaseService l.75 START
2017-02-04 22:33:12 [thread-1] com.github.some.project.DatabaseService l.93 STOP in 17ms
2017-02-04 22:33:12 [thread-2] com.github.some.project.DatabaseService l.94 #################
2017-02-04 22:33:12 [thread-1] com.github.some.project.DatabaseService l.124 java.sql.SQLIntegrityConstraintViolationException
at org.h2.message.DbException.getJdbcSQLException(DbException.java:345)
at org.h2.message.DbException.get(DbException.java:179)
at org.h2.message.DbException.get(DbException.java:155)
at org.h2.command.CommandContainer.update(CommandContainer.java:98)
at org.h2.command.Command.executeUpdate(Command.java:258)
at org.h2.jdbc.JdbcPreparedStatement.execute(JdbcPreparedStatement.java:201)
... 50 more</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 10. Câest dÃ©jÃ  mieux</div>
<div class="content">
<pre class="rouge highlight"><code>2017-02-04 22:33:12.332 INFO  5jhgd45ui74h c.g.s.p.UserService.create [Joshua] [Bloch] Save successful
2017-02-04 22:33:12.758 INFO  6jyg45hgduyg c.g.s.p.UserService.create [Doug] [Lea] Save successful
2017-02-04 22:33:12.964 ERROR hg457gehe4rt c.g.s.p.UserService.create [James] [Gosling] Save KO: already exists</code></pre>
</div>
</div>
<div class="paragraph">
<p>Les logs ou fichiers dâÃ©vÃ¨nements sont ces <em>fichiers</em> qui contiennent les informations nÃ©cessaires au diagnostique en cas de problÃ¨me.<br>
Elles peuvent Ã©galement Ãªtre utilisÃ©es comme source de donnÃ©es pour crÃ©er des mÃ©triques de supervision.<br>
Les logs sont souvent la seule trace de la chronologie des Ã©vÃ¨nements et sont dâautant plus importantes dans les applications Ã  fort traffic, oÃ¹ rÃ©soudre le problÃ¨me dâun utilisateur peut sâapparenter Ã  chercher une aiguille dans une botte de foin.</p>
</div>
<div class="paragraph">
<p>Afin de pouvoir exploiter au mieux les logs, il est important de les centraliser.<br>
Câest-Ã -dire les envoyer dans un mÃªme endroit, que ce soit dans un :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SystÃ¨me de fichier, sur lequel on pourra utiliser la commande <code>grep</code> par exemple</p>
</li>
<li>
<p><em>ElasticSearch</em>, <em>Loki</em> ou Ã©quivalent, sur lequel on pourra faire des requÃªtes</p>
</li>
<li>
<p>SAAS dont câest le coeur de mÃ©tier (<em>Datadog</em>, <em>Logz.io</em>, etc.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Les logs doivent Ãªtre claires et apporter le maximum dâinformation possible.<br>
Pour cela on Ã©vite les logs visuelles ou de <em>debug</em>.</p>
</div>
<div class="sect3">
<h4 id="_la_stack_elastic">6.2.1. La stack Elastic</h4>
<div class="paragraph">
<p>Il existe plusieurs solutions de centralisation <em>on premise</em>, la plus connue Ã©tant la suite proposÃ©e par <em>Elastic</em> : <strong>ELK</strong> (<strong>E</strong>lasticSearch, <strong>L</strong>ogstash, <strong>K</strong>ibana).<br>
Aujourdâhui un peu datÃ©e, des composants peuvent Ãªtre remplacÃ©s, la chaÃ®ne peut Ãªtre plus complexe pour mieux gÃ©rer le dimensionnement, mais la structure reste nÃ©anmoins identique.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/elk_stack.png" alt="elk stack">
</div>
</div>
<div class="paragraph">
<p>La brique <strong>Logstash</strong> permet de dÃ©couper les lignes de logs en documents structurÃ©s (JSON) pour ensuite les envoyer Ã  <strong>ElasticSearch</strong>.<br>
<strong>ElasticSearch</strong> indexe les documents reÃ§us et propose une API de recherche utilisÃ©e par <strong>Kibana</strong>.<br>
<strong>Kibana</strong> fourni une interface Web qui satisfait aussi bien Ã  la recherche exploratoire quâÃ  la crÃ©ation de tableaux de bord pour suivre lâÃ©tat du systÃ¨me.</p>
</div>
</div>
<div class="sect3">
<h4 id="_bibliothÃ¨ques_de_log">6.2.2. BibliothÃ¨ques de log</h4>
<div class="paragraph">
<p>CÃ´tÃ© applicatif, il existe de nombreuses bibliothÃ¨ques pour Ã©crire dans des fichiers de logs.</p>
</div>
<div class="paragraph">
<p>Rien que dans lâunivers Java, on peut trouver</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JUL (<strong>J</strong>ava <strong>U</strong>til <strong>L</strong>ogging) minimaliste, fourni par le JDK</p>
</li>
<li>
<p>Apache JULI (<strong>J</strong>ava <strong>U</strong>til <strong>L</strong>ogging <strong>I</strong>nterface)</p>
</li>
<li>
<p>Apache Commons Logging</p>
</li>
<li>
<p>Apache Log4J</p>
</li>
<li>
<p>JBoss Logging</p>
</li>
<li>
<p>Logback</p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>On retrouve dans ces diffÃ©rents outils des concepts communs :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DÃ©couplage entre le composant qui collecte les logs (<code>Logger</code>) et celui qui Ã©crit Ã  lâextÃ©rieur du systÃ¨me (<code>Appender</code>)</p>
</li>
<li>
<p>Configuration extÃ©rieure au code (fichier, propriÃ©tÃ©s systÃ¨me)</p>
</li>
<li>
<p>Niveaux de sÃ©vÃ©ritÃ©s</p>
<div class="ulist">
<ul>
<li>
<p><strong>DEBUG</strong> : utilise pour le dÃ©veloppement, invisible une fois lâapplication dÃ©ployÃ©e en dehors dâun poste de dÃ©veloppement</p>
</li>
<li>
<p><strong>INFO</strong> : information sur un Ã©vÃ¨nement dans le systÃ¨me (changement dâÃ©tat ou rÃ©action Ã  une sollicitation exogÃ¨ne)</p>
</li>
<li>
<p><strong>WARN</strong> : une erreur est survenue, le systÃ¨me ne sâest pas comportÃ© comme prÃ©vu, mais aucune intervention humaine nâest requise immÃ©diatement</p>
</li>
<li>
<p><strong>ERROR</strong> : une erreur est survenue, une intervention humaine est requise pour corriger le problÃ¨me</p>
</li>
<li>
<p>(<strong>FATAL</strong> : une erreur <span class="underline">irrÃ©mÃ©diable</span> est survenue, suite Ã  quoi le systÃ¨me sâest arrÃªtÃ©)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Une erreur mÃ©tier nâest pas forcÃ©ment une erreur technique.<br>
Par exemple : un utilisateur qui entre un mauvais mot de passe est un cas mÃ©tier normal, gÃ©rÃ© par le code, et lâÃ©vÃ¨nement correspondant (sâil est tracÃ©) est de sÃ©vÃ©ritÃ© <strong>INFO</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_architecture_de_slf4j">Architecture de SLF4J</h5>
<div class="paragraph">
<p>Le problÃ¨me avec cette multiplicitÃ© de choix dâoutil est que lâÃ©cosystÃ¨me sâest construit de maniÃ¨re hÃ©tÃ©rogÃ¨ne.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tomcat utilise <strong>JUL</strong> Ã  travers lâabstraction <strong>JULI</strong>.</p>
</li>
<li>
<p>Spring utilise <strong>Apache Commons Logging</strong>.</p>
</li>
<li>
<p>Le client <strong>HBase</strong> officiel utilise <strong>Log4j</strong>.</p>
</li>
<li>
<p>Etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Une application qui utilise diffÃ©rents frameworks et bibliothÃ¨ques devrait alors configurer chacune de ces technologies de <em>logging</em> et ce de maniÃ¨re cohÃ©rente (mÃªme format de ligne, mÃªme fichier, mÃªme sÃ©vÃ©ritÃ© minimum, etc.).</p>
</div>
<div class="paragraph">
<p>Ce serait pÃ©nible, et le risque de problÃ¨mes serait Ã©levÃ© (concurrence dâaccÃ¨s sur un mÃªme fichier, etc.).</p>
</div>
<div class="paragraph">
<p>Une technologie existe cependant, pour unifier tous ces outils : <strong>SLF4J</strong>.</p>
</div>
<div class="paragraph">
<p>Cet outil est composÃ©</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dâune <strong><em>API abstraite</em></strong> reprÃ©sentant de maniÃ¨re unifiÃ©e un grand nombre des fonctionnalitÃ©s des bibliothÃ¨ques de log existantes</p>
</li>
<li>
<p>Dâ<strong><em>adaptateurs</em></strong> entre cette API et les bibliothÃ¨ques de logs existantes qui ne lâimplÃ©mentent pas</p>
</li>
<li>
<p>De <strong><em>bridges</em></strong>, bibliothÃ¨ques ayant la mÃªme compatibilitÃ© binaire (mÃªme noms qualifiÃ©s des classes, mÃªme signatures des mÃ©thodes) que les bibliothÃ¨ques de logs existantes, mais redirigeant les messages vers lâ<strong><em>API abstraite</em></strong></p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/slf4j_bridges.png" alt="slf4j bridges">
</div>
</div>
<div class="paragraph">
<p>Dans une application mettant cette technologie Ã  profit, toutes les logs sont redirigÃ©es vers cette <strong><em>API abstraite</em></strong> et envoyÃ©es vers une seule et unique bibliothÃ¨que de log.</p>
</div>
<div class="paragraph">
<p>La configuration est alors faite une fois, et il nây a plus de risque de concurrence dâaccÃ¨s.</p>
</div>
</div>
<div class="sect4">
<h5 id="_mdc_mapped_diagnostic_context">MDC (Mapped Diagnostic Context)</h5>
<div class="paragraph">
<p>Le <strong>MDC</strong> est un outil fourni par la plupart des bibliothÃ¨ques de log qui permet de transporter de lâinformation dans un mÃªme thread.</p>
</div>
<div class="paragraph">
<p>LâidÃ©e est dâenrichir les informations transverses utiles pour une ligne de log au fur et Ã  mesure de leur disponibilitÃ©, sans avoir Ã  les passer en paramÃ¨tres de toutes les mÃ©thodes prÃ©cÃ©dant lâÃ©criture du message.</p>
</div>
<div class="paragraph">
<p>ConsidÃ©rant ce code :</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. Fichier MyController.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">class</span> <span class="nc">MyController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MyService</span> <span class="n">service</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">User</span> <span class="nf">newUser</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">,</span> <span class="nd">@Header</span><span class="o">(</span><span class="s">"correlationId"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">correlationId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="na">newUser</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">correlationId</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 12. Fichier MyService.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">class</span> <span class="nc">MyService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">MyService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MyRepository</span> <span class="n">repository</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">User</span> <span class="nf">newUser</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">,</span> <span class="nc">String</span> <span class="n">correlationId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">isValid</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">correlationId</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">repository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">correlationId</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidUserException</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">,</span> <span class="nc">String</span> <span class="n">correlationId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">age</span> <span class="o">&gt;</span> <span class="mi">110</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"["</span> <span class="o">+</span> <span class="n">correlationId</span> <span class="o">+</span> <span class="s">"] Invalid User: too old"</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">age</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"["</span> <span class="o">+</span> <span class="n">correlationId</span> <span class="o">+</span> <span class="s">"] Invalid User: too young"</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La variable <code>correlationId</code> est passÃ© systÃ©matiquement car il est nÃ©cessaire de la logger Ã  chaque fois pour rÃ©concilier plusieurs lignes de logs qui concernent le mÃªme appel dâun utilisateur.</p>
</div>
<div class="paragraph">
<p>Câest une bonne candidate pour le <strong>MDC</strong> :</p>
</div>
<div class="listingblock">
<div class="title">Listing 13. Fichier MyController.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">class</span> <span class="nc">MyController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MyService</span> <span class="n">service</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">User</span> <span class="nf">newUser</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">,</span> <span class="nd">@Header</span><span class="o">(</span><span class="s">"correlationId"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">correlationId</span><span class="o">)</span> <span class="o">{</span>
        <span class="no">MDC</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"correlationId"</span><span class="o">,</span> <span class="n">correlationId</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="na">newUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 14. Fichier MyService.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">class</span> <span class="nc">MyService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">MyService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MyRepository</span> <span class="n">repository</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">User</span> <span class="nf">newUser</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">isValid</span><span class="o">(</span><span class="n">user</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">repository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidUserException</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">age</span> <span class="o">&gt;</span> <span class="mi">110</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Invalid User: too old"</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">age</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Invalid User: too young"</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Il nây a plus quâÃ  configurer le bon format de sortie des lignes de log pour que le <code>correlationId</code> soit prÃ©sent.</p>
</div>
<div class="listingblock">
<div class="title">Listing 15. Fichier logback.xml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;configuration&gt;</span>

  <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"STDOUT"</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.ConsoleAppender"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;encoder&gt;</span>
      <span class="nt">&lt;pattern&gt;</span>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - [%X{correlationId}] %msg%n<span class="nt">&lt;/pattern&gt;</span> &lt;!--<b class="conum">(1)</b>--&gt;
    <span class="nt">&lt;/encoder&gt;</span>
  <span class="nt">&lt;/appender&gt;</span>

  <span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">"DEBUG"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"STDOUT"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/root&gt;</span>
<span class="nt">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Ici une ligne de log sera structurÃ©e comme suit : &lt;heure&gt; &lt;nom du thread&gt; &lt;sÃ©vÃ©ritÃ©&gt; &lt;nom de la classe&gt; - &lt;correlationId&gt; &lt;message&gt;</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_logs_gc">6.2.3. Logs GC</h4>
<div class="paragraph">
<p>Les logs applicatives sont une chose, mais quand un problÃ¨me arrive en production, son origine ou ses symptÃ´mes peuvent Ãªtre techniques.</p>
</div>
<div class="paragraph">
<p>Il est important de ne pas oublier dâactiver les logs du <strong>G</strong>arbarge <strong>C</strong>ollector.<br>
Cela se fait avec un flag sur la ligne de commande du dÃ©marrage de la JVM :</p>
</div>
<div class="paragraph">
<p><code>-Xlog:gc=debug:file=gc.log:pid,time,uptimemillis:filecount=5,filesize=1M</code></p>
</div>
<div class="paragraph">
<p>Ici la JVM va Ã©crire les Ã©vÃ¨nements Ã  partir de la sÃ©vÃ©ritÃ© <strong>debug</strong> dans un fichier <strong>gc.log</strong> (en gÃ©rant la rotation sur 5 fichiers max de 1M chacun) avec les informations PID (processus ID), heure et durÃ©e dâexÃ©cution de lâapplication.</p>
</div>
<div class="paragraph">
<p>Plus dâoptions ici : <a href="https://openjdk.java.net/jeps/158" class="bare">https://openjdk.java.net/jeps/158</a></p>
</div>
<div class="paragraph">
<p><span class="underline">Alternativement</span> des outils de collecte de mÃ©triques tels que <strong>Micrometer</strong> peuvent exporter ces informations vers des systÃ¨mes ingÃ©rant des <em>sÃ©ries temporelles</em> (Time Series) tels que <strong>Graphite</strong>, <strong>Warp10</strong> ou <strong>Prometheus</strong> (pour du on-premise).</p>
</div>
</div>
<div class="sect3">
<h4 id="_heap_dump">6.2.4. Heap Dump</h4>
<div class="paragraph">
<p>Quand la JVM sâarrÃªte de maniÃ¨re non prÃ©vue, cela peut Ãªtre Ã  cause dâun problÃ¨me de mÃ©moire (<strong>O</strong>ut <strong>O</strong>f <strong>M</strong>emory error) et dans ce cas lâinvestigation peut se faire sur la base dâun <strong>Heap Dump</strong>.</p>
</div>
<div class="paragraph">
<p>Un <strong>Heap Dump</strong> est une projection sur fichier de lâÃ©tat de la mÃ©moire de la JVM.</p>
</div>
<div class="paragraph">
<p>Voici donc le flag Ã  ne pas oublier sur la ligne de commande du dÃ©marrage de la JVM :</p>
</div>
<div class="paragraph">
<p><code>-XX:+HeapDumpOnOutOfMemoryError</code></p>
</div>
<div class="paragraph">
<p>Par la suite un tel fichier peut Ãªtre analysÃ© avec des outils comme <strong>Eclipse MAT</strong> (gratuit) ou <strong>JProfiler</strong> (payant).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_supervision">6.3. Supervision</h3>
<div class="paragraph">
<p>La collecte de logs et de mÃ©triques forme la base de la <em>supervision</em> dâun systÃ¨me.</p>
</div>
<div class="paragraph">
<p>Sur cette base, il est nÃ©cessaire dâajouter des composants pour transformer ces donnÃ©es brutes en :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Alertes, dans le cas oÃ¹ un comportement anormal est dÃ©tectÃ©</p>
</li>
<li>
<p>Tableaux de bord, pour investiguer un comportement anormal, trouver des correlations et converger vers lâorigine du problÃ¨me.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La supervision, câest lâoutillage qui permet de suivre lâÃ©tat dâun systÃ¨me, de comprendre son fonctionnement, et mÃªme de prÃ©voir son utilisation.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Conseil</div>
</td>
<td class="content">
<div class="paragraph">
<p>Il faut nÃ©anmoins faire preuve de retenue et ne garder que les informations qui ont de la valeur, au risque de se perdre dans trop dâinformation et de devoir stocker dâÃ©normes quantitÃ©s dâinformations inutiles.</p>
</div>
<div class="paragraph">
<p>Le rÃ©sultat doit Ãªtre construit Ã  lâaide de ces trois questions :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Quels sont les comportements du systÃ¨me que lâon souhaite identifier comme problÃ©matiques (service indisponible, utilisation anormale, etc.) ?</p>
</li>
<li>
<p>Quels comportements du systÃ¨me souhaite-t-on comprendre (coup de bÃ©lier, interruption de services externes, etc.) ?</p>
</li>
<li>
<p>OÃ¹ placer les sondes qui remonterons les informations nÃ©cessaires ?</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Que ce soit des outils dâindexation de document, de stockage de sÃ©ries temporelles ou des bases de donnÃ©es, tous sont des sources dâinformation pour la constitution de tableaux de bord et dâalerte.</p>
</div>
<div class="paragraph">
<p>Lâoutil open-source le plus complet aujourdâhui pour aggrÃ©ger ces sources est Grafana</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/grafana.png" alt="grafana">
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Contrairement Ã  ce que lâindustrie en France tente de nous faire croire, Ãªtre Architecte Logiciel nâest pas un mÃ©tier Ã  part.</p>
</div>
<div class="paragraph">
<p>Ces questions dâarchitectures doivent Ãªtre traitÃ©es par lâÃ©quipe de dÃ©veloppement, chacun Ã  la mesure de son expÃ©rience.</p>
</div>
<div class="paragraph">
<p>Ce sont bien des <span class="underline">dÃ©veloppeurs</span> qui doivent rÃ©flÃ©chir aux consÃ©quences de leurs rÃ©alisations et qui de toute faÃ§on les assumerons une fois le produit en production.</p>
</div>
<div class="paragraph">
<p>Lâarchitecture logicielle, tout comme la veille technologique, fait partie intÃ©grante du portefeuille dâoutils dâun dÃ©veloppeur.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_pour_aller_plus_loin">Pour aller plus loin</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Out of the tar pit, traitÃ© sur la complexitÃ©<br>
<a href="https://github.com/papers-we-love/papers-we-love/blob/master/design/out-of-the-tar-pit.pdf" class="bare">https://github.com/papers-we-love/papers-we-love/blob/master/design/out-of-the-tar-pit.pdf</a></p>
</li>
<li>
<p>Agile Manifesto<br>
<a href="https://agilemanifesto.org/" class="bare">https://agilemanifesto.org/</a></p>
</li>
<li>
<p>Blogs de</p>
<div class="ulist">
<ul>
<li>
<p>Martin Fowler<br>
<a href="https://martinfowler.com/" class="bare">https://martinfowler.com/</a></p>
</li>
<li>
<p>Simon Brown<br>
<a href="https://www.codingthearchitecture.com/" class="bare">https://www.codingthearchitecture.com/</a></p>
</li>
<li>
<p>Jessie Frazelle<br>
<a href="https://blog.jessfraz.com/" class="bare">https://blog.jessfraz.com/</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>VidÃ©os YouTube de confÃ©rences</p>
<div class="ulist">
<ul>
<li>
<p>Devoxx</p>
</li>
<li>
<p>goto;</p>
</li>
<li>
<p>DevFest</p>
</li>
<li>
<p>JUGs (<strong>J</strong>ava <strong>U</strong>ser <strong>G</strong>roup)</p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Sites dâactualitÃ©s et de contenu</p>
<div class="ulist">
<ul>
<li>
<p>InfoQ <a href="https://www.infoq.com/fr/" class="bare">https://www.infoq.com/fr/</a></p>
</li>
<li>
<p>Developpez <a href="https://www.developpez.com/" class="bare">https://www.developpez.com/</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
</div>
</div>
</body>
</html>